<!DOCTYPE html>
<html lang="fr" class="dark">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Admin - Teaser</title>
        <link rel="icon" type="image/x-icon" href="{{ url_for('static', path='icons/favicon.ico') }}">
        <script src="https://cdn.tailwindcss.com"></script>

        <script>
            tailwind.config = {
                darkMode: 'class',
                theme: {
                    extend: {
                        colors: {
                            primary: {
                                50: '#f0f9ff',
                                500: '#6366f1',
                                600: '#4f46e5',
                                700: '#3730a3'
                            },
                            secondary: {
                                500: '#8b5cf6',
                                600: '#7c3aed'
                            }
                        },
                        animation: {
                            'fade-in': 'fadeIn 0.3s ease-out',
                            'slide-up': 'slideUp 0.3s ease-out',
                            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        },
                        keyframes: {
                            fadeIn: {
                                '0%': {opacity: '0', transform: 'translateY(20px)'},
                                '100%': {opacity: '1', transform: 'translateY(0)'}
                            },
                            slideUp: {
                                '0%': {transform: 'translateY(100%)'},
                                '100%': {transform: 'translateY(0)'}
                            }
                        }
                    }
                }
            }
        </script>

        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

        <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

        <style>
            body {font-family: 'Inter', sans-serif;}
            .sidebar-collapsed {width: 80px;}
            .gradient-bg {background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);}
            .glass {backdrop-filter: blur(20px);}
            .spinner {animation: spin 1s linear infinite;}
            @keyframes spin {from {transform: rotate(0deg);} to {transform: rotate(360deg);}}
        </style>
    </head>

<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 font-inter">

    <!-- Chargement de superposition -->
     <div id="loading-overlay" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center opacity-0 invisible transition-all duration-300">
        <div class="text-center text-white">
            <div class="w-12 h-12 border-4 border-white/30 border-t-white rounded-full spinner mx-auto mb-4"></div>
            <span>Chargement...</span>
        </div>
     </div>

    <!-- Header -->
     <header class="fixed top-0 left-0 right-0 h-16 bg-white/90 dark:bg-gray-900/90 backdrop-blur-xl border-b border-gray-200 dark:border-gray-800 z-40">
        <div class="flex items-center justify-between px-6 h-full">

            <!-- Side gauche -->
            <div class="flex items-center space-x-4">
                <button id="menu-toggle" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                    <i class="fas fa-bars text-gray-600 dark:text-gray-300"></i>
                </button>
                
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-gradient-to-r from-primary-500 to-secondary-500 rounded-lg flex items-center justify-center">
                        <i class="fas fa-tv text-white text-sm"></i>
                    </div>
                    <div>
                        <h1 class="font-bold text-lg bg-gradient-to-r from-primary-500 to-secondary-500 bg-clip-text text-transparent">TEASER Admin</h1>
                        <p class="text-xs text-gray-500 dark:text-gray-400">Module Événementiel</p>
                    </div>
                </div>
            </div>

            <!-- Centre Breadcrumb -->
            <nav class="hidden md:flex items-center">
                <span id="current-section" class="text-sm font-medium text-primary-600 dark:text-primary-400">Configuration Visuelle</span>
            </nav>

            <!-- Side droite -->
            <div class="flex items-center space-x-3">
                <!-- Status -->
                <div class="hidden sm:flex items-center space-x-2 px-3 py-1 bg-green-100 dark:bg-green-900/30 rounded-full">
                    <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse-slow"></div>
                    <span class="text-sm font-medium text-green-700 dark:text-green-300" id="connection-status">En ligne</span>
                </div>
                
                <!-- Thème Toggle -->
                <button id="theme-toggle" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                    <i class="fas fa-moon text-gray-600 dark:text-gray-300"></i>
                </button>
                
                <!-- Action Buttons -->
                <button onclick="openPreview()" class="hidden md:flex items-center space-x-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:shadow-lg transition-all duration-200 hover:-translate-y-0.5">
                    <i class="fas fa-eye"></i>
                    <span class="font-medium">Aperçu</span>
                </button>
                
                <button onclick="openDJ()" class="hidden lg:flex items-center space-x-2 px-4 py-2 bg-gradient-to-r from-pink-500 to-red-500 text-white rounded-lg hover:shadow-lg transition-all duration-200 hover:-translate-y-0.5">
                    <i class="fas fa-music"></i>
                    <span class="font-medium">DJ</span>
                </button>
                
                <button onclick="saveAllConfig()" id="save-btn" class="flex items-center space-x-2 px-4 py-2 bg-gradient-to-r from-primary-500 to-secondary-500 text-white rounded-lg hover:shadow-lg transition-all duration-200 hover:-translate-y-0.5 relative">
                    <i class="fas fa-save"></i>
                    <span class="hidden md:inline font-medium">Sauvegarder</span>
                    <div id="save-indicator" class="absolute -top-1 -right-1 w-3 h-3 bg-yellow-500 rounded-full opacity-0 scale-0 transition-all duration-200"></div>
                </button>
                
                <!-- Menu Utilisateur -->
                <!-- <div class="relative">
                    <button id="user-menu-toggle" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                        <i class="fas fa-user-circle text-gray-600 dark:text-gray-300 text-xl"></i>
                    </button>
                    
                    <div id="user-dropdown" class="absolute right-0 top-12 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 opacity-0 invisible transform scale-95 transition-all duration-200 z-50">
                        <a href="#" onclick="viewLogs()" class="flex items-center space-x-3 px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                            <i class="fas fa-file-alt text-gray-400"></i>
                            <span>Voir les logs</span>
                        </a>
                        <a href="#" onclick="downloadBackup()" class="flex items-center space-x-3 px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                            <i class="fas fa-download text-gray-400"></i>
                            <span>Télécharger backup</span>
                        </a>
                        <hr class="border-gray-200 dark:border-gray-700">
                        <a href="/" target="_blank" class="flex items-center space-x-3 px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors rounded-b-lg">
                            <i class="fas fa-external-link-alt text-gray-400"></i>
                            <span>Retour au site</span>
                        </a>
                    </div>
                </div> -->
            </div>

        </div>
     </header>

     <!-- Superposition barre latérale (mobile) -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 z-30 opacity-0 invisible transition-all duration-300 lg:hidden"></div>

    <!-- Conteneur principal -->
     <div class="flex pt-16">

        <!-- Sidebar -->
         <aside id="admin-sidebar" class="fixed left-0 top-16 h-[calc(100vh-4rem)] w-80 bg-white/90 dark:bg-gray-900/90 backdrop-blur-xl border-r border-gray-200 dark:border-gray-800 z-30 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 overflow-y-auto">

            <!-- Navigation -->
             <nav class="p-6">
                <div class="space-y-8">
                    
                    <!-- Configuration section -->
                    <div>
                        <h4 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3">Configuration</h4>
                        
                        <a href="#" class="nav-item active flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors group" data-section="mockup">
                            <div class="w-8 h-8 bg-primary-100 dark:bg-primary-900/50 rounded-lg flex items-center justify-center group-hover:bg-primary-200 dark:group-hover:bg-primary-800/50 transition-colors">
                                <i class="fas fa-desktop text-primary-600 dark:text-primary-400 text-sm"></i>
                            </div>
                            <div class="flex-1">
                                <div class="font-medium text-gray-900 dark:text-gray-100">Configuration Visuelle</div>
                                <div class="text-xs text-gray-500 dark:text-gray-400">Mockup interactif</div>
                            </div>
                        </a>
                        
                        <a href="#" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors group" data-section="media">
                            <div class="w-8 h-8 bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center group-hover:bg-gray-200 dark:group-hover:bg-gray-700 transition-colors">
                                <i class="fas fa-images text-gray-600 dark:text-gray-400 text-sm"></i>
                            </div>
                            <div class="flex-1">
                                <div class="font-medium text-gray-900 dark:text-gray-100">Gestion Médias</div>
                                <div class="text-xs text-gray-500 dark:text-gray-400">Upload & organisation</div>
                            </div>
                        </a>
                        
                        <a href="#" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors group" data-section="apis">
                            <div class="w-8 h-8 bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center group-hover:bg-gray-200 dark:group-hover:bg-gray-700 transition-colors">
                                <i class="fas fa-cloud text-gray-600 dark:text-gray-400 text-sm"></i>
                            </div>
                            <div class="flex-1">
                                <div class="font-medium text-gray-900 dark:text-gray-100">APIs & Services</div>
                                <div class="text-xs text-gray-500 dark:text-gray-400">Météo, marées</div>
                            </div>
                        </a>
                        
                        <a href="#" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors group" data-section="modules">
                            <div class="w-8 h-8 bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center group-hover:bg-gray-200 dark:group-hover:bg-gray-700 transition-colors">
                                <i class="fas fa-puzzle-piece text-gray-600 dark:text-gray-400 text-sm"></i>
                            </div>
                            <div class="flex-1">
                                <div class="font-medium text-gray-900 dark:text-gray-100">Modules Liés</div>
                                <div class="text-xs text-gray-500 dark:text-gray-400">Selfie, DJ, Karaoké</div>
                            </div>
                        </a>
                    </div>
                    
                    <!-- Système section -->
                    <div>
                        <h4 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3">Système</h4>
                        
                        <a href="#" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors group" data-section="system">
                            <div class="w-8 h-8 bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center group-hover:bg-gray-200 dark:group-hover:bg-gray-700 transition-colors">
                                <i class="fas fa-cogs text-gray-600 dark:text-gray-400 text-sm"></i>
                            </div>
                            <div class="flex-1">
                                <div class="font-medium text-gray-900 dark:text-gray-100">Configuration</div>
                                <div class="text-xs text-gray-500 dark:text-gray-400">Performance, nettoyage</div>
                            </div>
                        </a>
                        
                        <a href="#" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors group" data-section="analytics">
                            <div class="w-8 h-8 bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center group-hover:bg-gray-200 dark:group-hover:bg-gray-700 transition-colors">
                                <i class="fas fa-chart-line text-gray-600 dark:text-gray-400 text-sm"></i>
                            </div>
                            <div class="flex-1">
                                <div class="font-medium text-gray-900 dark:text-gray-100">Statistiques</div>
                                <div class="text-xs text-gray-500 dark:text-gray-400">Usage & performances</div>
                            </div>
                        </a>
                    </div>
                </div>
            </nav>

            <!-- Actions rapides -->
             <div class="p-6 border-t border-gray-200 dark:border-gray-800">
                <h4 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3">Actions Rapides</h4>
                
                <div class="space-y-2">
                    <button onclick="refreshAllData()" class="w-full flex items-center space-x-3 p-3 text-left rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                        <i class="fas fa-sync-alt text-gray-400 w-4"></i>
                        <span class="text-sm">Actualiser</span>
                    </button>
                    
                    <button onclick="runCleanup()" class="w-full flex items-center space-x-3 p-3 text-left rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                        <i class="fas fa-broom text-gray-400 w-4"></i>
                        <span class="text-sm">Nettoyer</span>
                    </button>
                    
                    <button onclick="testAllConnections()" class="w-full flex items-center space-x-3 p-3 text-left rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                        <i class="fas fa-wifi text-gray-400 w-4"></i>
                        <span class="text-sm">Test APIs</span>
                    </button>
                </div>
            </div>

            <!-- Etat du système -->
             <div class="p-6 border-t border-gray-200 dark:border-gray-800">
                <h4 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3 flex items-center space-x-2">
                    <i class="fas fa-heartbeat text-red-500"></i>
                    <span>État Système</span>
                </h4>
                
                <div class="space-y-3">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center">
                            <i class="fas fa-server text-green-600 dark:text-green-400 text-xs"></i>
                        </div>
                        <div class="flex-1">
                            <div class="text-xs text-gray-500 dark:text-gray-400">Serveur</div>
                            <div class="text-sm font-medium text-green-600 dark:text-green-400" id="server-status">En ligne</div>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center">
                            <i class="fas fa-cloud-sun text-blue-600 dark:text-blue-400 text-xs"></i>
                        </div>
                        <div class="flex-1">
                            <div class="text-xs text-gray-500 dark:text-gray-400">API Météo</div>
                            <div class="text-sm font-medium text-gray-600 dark:text-gray-400" id="weather-status">Test...</div>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center">
                            <i class="fas fa-puzzle-piece text-purple-600 dark:text-purple-400 text-xs"></i>
                        </div>
                        <div class="flex-1">
                            <div class="text-xs text-gray-500 dark:text-gray-400">Modules</div>
                            <div class="text-sm font-medium text-gray-600 dark:text-gray-400" id="modules-status">0/3</div>
                        </div>
                    </div>
                </div>
                
                <!-- Mini graphique -->
                <!-- <div class="mt-4 h-16">
                    <canvas id="system-chart" class="w-full h-full opacity-70"></canvas>
                </div> -->
            </div>

            <!-- Footer -->
             <div class="p-6 border-t border-gray-200 dark:border-gray-800 text-center">
                <div class="text-xs text-gray-400">
                    <div>ADMIN - Module TEASER</div>
                </div>
            </div>

         </aside>

         <!-- Contenu principal -->
          <main id="admin-main" class="flex-1 lg:ml-80 p-6 min-h-screen">
            
            <!-- Bar de statistiques -->
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-xl p-4 border border-gray-200 dark:border-gray-700 hover:shadow-lg hover:-translate-y-0.5 transition-all duration-200">
                    <div class="flex items-center space-x-3">
                        <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-lg flex items-center justify-center">
                            <i class="fas fa-images text-white text-lg"></i>
                        </div>
                        <div>
                            <div class="text-2xl font-bold text-gray-900 dark:text-white" id="total-media">0</div>
                            <div class="text-sm text-gray-500 dark:text-gray-400">Médias</div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-xl p-4 border border-gray-200 dark:border-gray-700 hover:shadow-lg hover:-translate-y-0.5 transition-all duration-200">
                    <div class="flex items-center space-x-3">
                        <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-emerald-500 rounded-lg flex items-center justify-center">
                            <i class="fas fa-camera text-white text-lg"></i>
                        </div>
                        <div>
                            <div class="text-2xl font-bold text-gray-900 dark:text-white" id="total-selfies">0</div>
                            <div class="text-sm text-gray-500 dark:text-gray-400">Selfies</div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-xl p-4 border border-gray-200 dark:border-gray-700 hover:shadow-lg hover:-translate-y-0.5 transition-all duration-200">
                    <div class="flex items-center space-x-3">
                        <div class="w-12 h-12 bg-gradient-to-r from-pink-500 to-rose-500 rounded-lg flex items-center justify-center">
                            <i class="fas fa-music text-white text-lg"></i>
                        </div>
                        <div>
                            <div class="text-2xl font-bold text-gray-900 dark:text-white" id="total-music">0</div>
                            <div class="text-sm text-gray-500 dark:text-gray-400">Pistes</div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-xl p-4 border border-gray-200 dark:border-gray-700 hover:shadow-lg hover:-translate-y-0.5 transition-all duration-200">
                    <div class="flex items-center space-x-3">
                        <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-indigo-500 rounded-lg flex items-center justify-center">
                            <i class="fas fa-hdd text-white text-lg"></i>
                        </div>
                        <div>
                            <div class="text-2xl font-bold text-gray-900 dark:text-white" id="storage-used">0</div>
                            <div class="text-sm text-gray-500 dark:text-gray-400">MB utilisés</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Section: Configuration Visuelle -->
            <section id="mockup-section" class="admin-section animate-fade-in">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 space-y-4 sm:space-y-0">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-900 dark:text-white flex items-center space-x-3">
                            <i class="fas fa-desktop text-primary-600 dark:text-primary-400"></i>
                            <span>Configuration Visuelle</span>
                        </h2>
                        <p class="text-gray-600 dark:text-gray-400 mt-1">Cliquez sur les zones pour les configurer</p>
                    </div>
                </div>
                
                <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-2xl p-8 border border-gray-200 dark:border-gray-700">
                    <!-- Teaser maquette -->
                    <div class="gradient-bg rounded-xl p-6 grid grid-cols-1 lg:grid-cols-5 gap-4 min-h-[500px]">
                        
                        <!-- Zone gauche -->
                        <div class="lg:col-span-1 space-y-4">
                            <div class="mockup-card bg-white/20 backdrop-blur-md rounded-lg p-4 min-h-[120px] flex flex-col items-center justify-center text-white cursor-pointer hover:bg-white/30 hover:scale-105 transition-all duration-200 border border-white/20" onclick="openZoneConfig('left1')" data-zone="left1">
                                <div class="text-center">
                                    <i class="fas fa-plus text-2xl mb-2 opacity-70" id="left1-icon"></i>
                                    <div class="font-semibold">Zone 1</div>
                                    <div class="text-xs opacity-80" id="left1-count">0 éléments</div>
                                </div>
                                <div class="absolute top-2 right-2 opacity-0 hover:opacity-100 transition-opacity">
                                    <i class="fas fa-cog"></i>
                                </div>
                            </div>
                            
                            <div class="mockup-card bg-white/20 backdrop-blur-md rounded-lg p-4 min-h-[120px] flex flex-col items-center justify-center text-white cursor-pointer hover:bg-white/30 hover:scale-105 transition-all duration-200 border border-white/20" onclick="openZoneConfig('left2')" data-zone="left2">
                                <div class="text-center">
                                    <i class="fas fa-plus text-2xl mb-2 opacity-70" id="left2-icon"></i>
                                    <div class="font-semibold">Zone 2</div>
                                    <div class="text-xs opacity-80" id="left2-count">0 éléments</div>
                                </div>
                                <div class="absolute top-2 right-2 opacity-0 hover:opacity-100 transition-opacity">
                                    <i class="fas fa-cog"></i>
                                </div>
                            </div>
                            
                            <div class="mockup-card bg-white/20 backdrop-blur-md rounded-lg p-4 min-h-[120px] flex flex-col items-center justify-center text-white cursor-pointer hover:bg-white/30 hover:scale-105 transition-all duration-200 border border-white/20" onclick="openZoneConfig('left3')" data-zone="left3">
                                <div class="text-center">
                                    <i class="fas fa-plus text-2xl mb-2 opacity-70" id="left3-icon"></i>
                                    <div class="font-semibold">Zone 3</div>
                                    <div class="text-xs opacity-80" id="left3-count">0 éléments</div>
                                </div>
                                <div class="absolute top-2 right-2 opacity-0 hover:opacity-100 transition-opacity">
                                    <i class="fas fa-cog"></i>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Zone centrale -->
                        <div class="lg:col-span-3 flex items-center justify-center">
                            <div class="mockup-card bg-white/20 backdrop-blur-md rounded-lg p-8 w-full h-full min-h-[400px] flex flex-col items-center justify-center text-white cursor-pointer hover:bg-white/30 hover:scale-[1.02] transition-all duration-200 border border-white/20 relative" onclick="openZoneConfig('center')" data-zone="center">
                                <div class="text-center">
                                    <i class="fas fa-plus text-4xl mb-4 opacity-70" id="center-icon"></i>
                                    <div class="font-bold text-lg">Contenu Principal</div>
                                    <div class="text-sm opacity-80 mt-2" id="center-count">0 éléments</div>
                                </div>
                                <div class="absolute top-4 right-4 opacity-0 hover:opacity-100 transition-opacity">
                                    <i class="fas fa-cog"></i>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Zonde droite -->
                        <div class="lg:col-span-1 space-y-4">
                            <div class="widget bg-white/20 backdrop-blur-md rounded-lg p-4 text-white cursor-pointer hover:bg-white/30 hover:translate-x-1 transition-all duration-200 border border-white/20 flex flex-col items-center justify-center min-h-[100px] relative" onclick="openWeatherConfig()">
                                <i class="fas fa-cloud-sun text-xl mb-2"></i>
                                <div class="font-semibold text-sm">Météo/Marée</div>
                                <div class="absolute top-2 right-2">
                                    <i class="fas fa-circle text-xs opacity-60" id="weather-widget-status"></i>
                                </div>
                            </div>

                            <div class="widget bg-white/20 backdrop-blur-md rounded-lg p-4 text-white cursor-pointer hover:bg-white/30 hover:translate-x-1 transition-all duration-200 border border-white/20 flex flex-col items-center justify-center min-h-[100px] relative" onclick="openMusicConfig()">
                                <i class="fas fa-music text-xl mb-2"></i>
                                <div class="font-semibold text-sm">Musique</div>
                                <div class="absolute top-2 right-2">
                                    <i class="fas fa-circle text-xs opacity-60" id="music-widget-status"></i>
                                </div>
                            </div>
                            
                            <div class="widget bg-white/20 backdrop-blur-md rounded-lg p-4 text-white cursor-pointer hover:bg-white/30 hover:translate-x-1 transition-all duration-200 border border-white/20 flex flex-col items-center justify-center min-h-[100px] relative" onclick="openSelfieConfig()">
                                <i class="fas fa-camera text-xl mb-2"></i>
                                <div class="font-semibold text-sm">Selfie</div>
                                <div class="absolute top-2 right-2">
                                    <i class="fas fa-circle text-xs opacity-60" id="selfie-widget-status"></i>
                                </div>
                            </div>
                            
                        </div>
                    </div>
                    
                    <!-- Légendes -->
                    <div class="flex justify-center space-x-6 mt-6 text-sm text-gray-600 dark:text-gray-400">
                        <div class="flex items-center space-x-2">
                            <i class="fas fa-circle text-green-500 text-xs"></i>
                            <span>Actif</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <i class="fas fa-circle text-red-500 text-xs"></i>
                            <span>Inactif</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <i class="fas fa-circle text-yellow-500 text-xs"></i>
                            <span>Erreur</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section: Gestion des Médias -->
            <section id="media-section" class="admin-section hidden animate-fade-in">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 space-y-4 sm:space-y-0">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-900 dark:text-white flex items-center space-x-3">
                            <i class="fas fa-images text-primary-600 dark:text-primary-400"></i>
                            <span>Gestion des Médias</span>
                        </h2>
                    </div>
                    <button onclick="openBulkUpload()" class="flex items-center space-x-2 px-4 py-2 bg-gradient-to-r from-primary-500 to-secondary-500 text-white rounded-lg hover:shadow-lg transition-all duration-200 hover:-translate-y-0.5">
                        <i class="fas fa-upload"></i>
                        <span>Upload Multiple</span>
                    </button>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Gestion dropzones -->
                    <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-xl p-6 border border-gray-200 dark:border-gray-700">
                        <h3 class="font-semibold text-lg mb-4 text-gray-900 dark:text-white">Zone Gauche 1</h3>
                        <div id="dropzone-left1" class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center hover:border-primary-400 hover:bg-primary-50/50 dark:hover:bg-primary-900/20 transition-all cursor-pointer">
                            <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-4"></i>
                            <p class="text-gray-600 dark:text-gray-400 font-medium">Glissez vos fichiers ici</p>
                            <input type="file" class="file-input hidden" multiple accept="image/*,video/*">
                        </div>
                        <div id="media-list-left1" class="mt-4 space-y-2"></div>
                    </div>
                    <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-xl p-6 border border-gray-200 dark:border-gray-700">
                        <h3 class="font-semibold text-lg mb-4 text-gray-900 dark:text-white">Zone Gauche 2</h3>
                        <div id="dropzone-left2" class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center hover:border-primary-400 hover:bg-primary-50/50 dark:hover:bg-primary-900/20 transition-all cursor-pointer">
                            <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-4"></i>
                            <p class="text-gray-600 dark:text-gray-400 font-medium">Glissez vos fichiers ici</p>
                            <input type="file" class="file-input hidden" multiple accept="image/*,video/*">
                        </div>
                        <div id="media-list-left1" class="mt-4 space-y-2"></div>
                    </div>
                    <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-xl p-6 border border-gray-200 dark:border-gray-700">
                        <h3 class="font-semibold text-lg mb-4 text-gray-900 dark:text-white">Zone Gauche 3</h3>
                        <div id="dropzone-left3" class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center hover:border-primary-400 hover:bg-primary-50/50 dark:hover:bg-primary-900/20 transition-all cursor-pointer">
                            <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-4"></i>
                            <p class="text-gray-600 dark:text-gray-400 font-medium">Glissez vos fichiers ici</p>
                            <input type="file" class="file-input hidden" multiple accept="image/*,video/*">
                        </div>
                        <div id="media-list-left1" class="mt-4 space-y-2"></div>
                    </div>
                    <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-xl p-6 border border-gray-200 dark:border-gray-700">
                        <h3 class="font-semibold text-lg mb-4 text-gray-900 dark:text-white">Zone Centrale</h3>
                        <div id="dropzone-center" class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center hover:border-primary-400 hover:bg-primary-50/50 dark:hover:bg-primary-900/20 transition-all cursor-pointer">
                            <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-4"></i>
                            <p class="text-gray-600 dark:text-gray-400 font-medium">Glissez vos fichiers ici</p>
                            <input type="file" class="file-input hidden" multiple accept="image/*,video/*">
                        </div>
                        <div id="media-list-left1" class="mt-4 space-y-2"></div>
                    </div>
                </div>
            </section>

            <!-- Section: APIs & Services -->
            <section id="apis-section" class="admin-section hidden animate-fade-in">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900 dark:text-white flex items-center space-x-3">
                        <i class="fas fa-cloud text-primary-600 dark:text-primary-400"></i>
                        <span>APIs & Services</span>
                    </h2>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Configuration météo -->
                    <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-xl p-6 border border-gray-200 dark:border-gray-700">
                        <h3 class="font-semibold text-lg mb-4 text-gray-900 dark:text-white flex items-center space-x-2">
                            <i class="fas fa-cloud-sun text-blue-500"></i>
                            <span>Configuration Météo</span>
                        </h3>
                        
                        <form id="weather-config-form" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Clé API OpenWeatherMap</label>
                                <input type="text" name="weather_api_key" placeholder="Votre clé API" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Localisation</label>
                                <input type="text" name="weather_location" placeholder="Paris,FR" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Intervalle de refresh (minutes)</label>
                                <input type="number" name="weather_refresh" min="1" max="60" value="5" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors">
                            </div>
                            
                            <button type="button" onclick="testWeatherAPI()" class="w-full flex items-center justify-center space-x-2 px-4 py-2 bg-gradient-to-r from-purple-500 to-indigo-500 text-white rounded-lg hover:shadow-lg transition-all duration-200 hover:-translate-y-0.5">
                                <i class="fas fa-vial"></i>
                                <span>Tester</span>
                            </button>
                        </form>
                    </div>
                    
                    <!-- Configuration marée -->
                    <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-xl p-6 border border-gray-200 dark:border-gray-700">
                        <h3 class="font-semibold text-lg mb-4 text-gray-900 dark:text-white flex items-center space-x-2">
                            <i class="fas fa-water text-cyan-500"></i>
                            <span>Configuration Marées</span>
                        </h3>
                        
                        <form id="tide-config-form" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Clé API World Tides</label>
                                <input type="text" name="tide_api_key" placeholder="Votre clé API" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Latitude</label>
                                <input type="number" name="tide_lat" step="0.0001" placeholder="43.4832" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Longitude</label>
                                <input type="number" name="tide_lon" step="0.0001" placeholder="-1.5586" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors">
                            </div>
                            
                            <button type="button" onclick="testTideAPI()" class="w-full flex items-center justify-center space-x-2 px-4 py-2 bg-gradient-to-r from-purple-500 to-indigo-500 text-white rounded-lg hover:shadow-lg transition-all duration-200 hover:-translate-y-0.5">
                                <i class="fas fa-vial"></i>
                                <span>Tester</span>
                            </button>
                        </form>
                    </div>
                </div>
            </section>

            <!-- Section: Modules Liés -->
            <section id="modules-section" class="admin-section hidden animate-fade-in">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900 dark:text-white flex items-center space-x-3">
                        <i class="fas fa-puzzle-piece text-primary-600 dark:text-primary-400"></i>
                        <span>Modules Liés</span>
                    </h2>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Module selfie -->
                    <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-xl p-6 border border-gray-200 dark:border-gray-700">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-semibold text-lg text-gray-900 dark:text-white flex items-center space-x-2">
                                <i class="fas fa-camera text-green-500"></i>
                                <span>Module Selfie</span>
                            </h3>
                            <div class="flex items-center space-x-1">
                                <i class="fas fa-circle text-xs text-red-500" id="selfie-module-status"></i>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Dossier des selfies</label>
                                <input type="text" name="selfie_path" value="/static/selfies/" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Nombre d'images récentes</label>
                                <input type="number" name="selfie_count" min="1" max="10" value="3" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors">
                            </div>
                            
                            <button type="button" onclick="testSelfieModule()" class="w-full flex items-center justify-center space-x-2 px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-lg hover:shadow-lg transition-all duration-200 hover:-translate-y-0.5">
                                <i class="fas fa-link"></i>
                                <span>Tester Connexion</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Module DJ -->
                    <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-xl p-6 border border-gray-200 dark:border-gray-700">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-semibold text-lg text-gray-900 dark:text-white flex items-center space-x-2">
                                <i class="fas fa-music text-pink-500"></i>
                                <span>Module DJ/Jukebox</span>
                            </h3>
                            <div class="flex items-center space-x-1">
                                <i class="fas fa-circle text-xs text-red-500" id="dj-module-status"></i>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">URL du module DJ</label>
                                <input type="text" name="dj_url" placeholder="http://localhost:8001" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Refresh musique (secondes)</label>
                                <input type="number" name="music_refresh" min="1" max="30" value="5" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors">
                            </div>
                            
                            <button type="button" onclick="testDJModule()" class="w-full flex items-center justify-center space-x-2 px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-lg hover:shadow-lg transition-all duration-200 hover:-translate-y-0.5">
                                <i class="fas fa-link"></i>
                                <span>Tester Connexion</span>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section: Système -->
            <section id="system-section" class="admin-section hidden animate-fade-in">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900 dark:text-white flex items-center space-x-3">
                        <i class="fas fa-server text-primary-600 dark:text-primary-400"></i>
                        <span>Configuration Système</span>
                    </h2>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Performance -->
                    <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-xl p-6 border border-gray-200 dark:border-gray-700">
                        <h3 class="font-semibold text-lg mb-4 text-gray-900 dark:text-white flex items-center space-x-2">
                            <i class="fas fa-tachometer-alt text-blue-500"></i>
                            <span>Performance</span>
                        </h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Vitesse carrousels (secondes)</label>
                                <input type="number" name="carousel_speed" min="1" max="30" value="5" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Auto-play vidéos</label>
                                <select name="auto_play_videos" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors">
                                    <option value="true">Activé</option>
                                    <option value="false">Désactivé</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Volume vidéos</label>
                                <input type="range" name="video_volume" min="0" max="1" step="0.1" value="0.3" class="w-full accent-primary-500">
                                <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-1">
                                    <span>0%</span>
                                    <span id="volume-value">30%</span>
                                    <span>100%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- nettoyage -->
                    <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-xl p-6 border border-gray-200 dark:border-gray-700">
                        <h3 class="font-semibold text-lg mb-4 text-gray-900 dark:text-white flex items-center space-x-2">
                            <i class="fas fa-broom text-orange-500"></i>
                            <span>Nettoyage Auto</span>
                        </h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Nettoyage activé</label>
                                <select name="auto_cleanup" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors">
                                    <option value="false">Désactivé</option>
                                    <option value="true">Activé</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Conserver les fichiers (jours)</label>
                                <input type="number" name="cleanup_days" min="1" max="365" value="30" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors">
                            </div>
                            
                            <button type="button" onclick="runCleanup()" class="w-full flex items-center justify-center space-x-2 px-4 py-2 bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-lg hover:shadow-lg transition-all duration-200 hover:-translate-y-0.5">
                                <i class="fas fa-trash-alt"></i>
                                <span>Nettoyer Maintenant</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Debug -->
                    <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-xl p-6 border border-gray-200 dark:border-gray-700">
                        <h3 class="font-semibold text-lg mb-4 text-gray-900 dark:text-white flex items-center space-x-2">
                            <i class="fas fa-bug text-purple-500"></i>
                            <span>Logs & Debug</span>
                        </h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Mode debug</label>
                                <select name="debug_mode" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors">
                                    <option value="false">Production</option>
                                    <option value="true">Debug</option>
                                </select>
                            </div>
                            
                            <button type="button" onclick="viewLogs()" class="w-full flex items-center justify-center space-x-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-lg hover:shadow-lg transition-all duration-200 hover:-translate-y-0.5 mb-2">
                                <i class="fas fa-file-alt"></i>
                                <span>Voir Logs</span>
                            </button>
                            
                            <button type="button" onclick="downloadBackup()" class="w-full flex items-center justify-center space-x-2 px-4 py-2 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg hover:shadow-lg transition-all duration-200 hover:-translate-y-0.5">
                                <i class="fas fa-download"></i>
                                <span>Backup Config</span>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section: Analytics -->
            <section id="analytics-section" class="admin-section hidden animate-fade-in">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900 dark:text-white flex items-center space-x-3">
                        <i class="fas fa-chart-line text-primary-600 dark:text-primary-400"></i>
                        <span>Statistiques & Analytics</span>
                    </h2>
                    <p class="text-gray-600 dark:text-gray-400 mt-1">Analyse détaillée de l'utilisation du système TEASER</p>
                </div>
                
                <!-- Cartes de statistiques détaillées -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <!-- Médias -->
                    <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-xl p-6 border border-gray-200 dark:border-gray-700 hover:shadow-lg transition-all duration-200">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-lg flex items-center justify-center">
                                <i class="fas fa-images text-white text-xl"></i>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-bold text-gray-900 dark:text-white" id="stats-total-media">0</div>
                                <div class="text-sm text-gray-500 dark:text-gray-400">Total médias</div>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600 dark:text-gray-400">Zone 1:</span>
                                <span class="font-medium" id="stats-left1">0</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600 dark:text-gray-400">Zone 2:</span>
                                <span class="font-medium" id="stats-left2">0</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600 dark:text-gray-400">Zone 3:</span>
                                <span class="font-medium" id="stats-left3">0</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600 dark:text-gray-400">Centre:</span>
                                <span class="font-medium" id="stats-center">0</span>
                            </div>
                        </div>
                    </div>

                    <!-- Selfies -->
                    <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-xl p-6 border border-gray-200 dark:border-gray-700 hover:shadow-lg transition-all duration-200">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-emerald-500 rounded-lg flex items-center justify-center">
                                <i class="fas fa-camera text-white text-xl"></i>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-bold text-gray-900 dark:text-white" id="stats-total-selfies">0</div>
                                <div class="text-sm text-gray-500 dark:text-gray-400">Selfies</div>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600 dark:text-gray-400">Aujourd'hui:</span>
                                <span class="font-medium text-green-600" id="stats-selfies-today">0</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600 dark:text-gray-400">Cette semaine:</span>
                                <span class="font-medium" id="stats-selfies-week">0</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600 dark:text-gray-400">Total:</span>
                                <span class="font-medium" id="stats-selfies-avg">0 MB</span>
                            </div>
                        </div>
                    </div>

                    <!-- Musique -->
                    <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-xl p-6 border border-gray-200 dark:border-gray-700 hover:shadow-lg transition-all duration-200">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-gradient-to-r from-pink-500 to-rose-500 rounded-lg flex items-center justify-center">
                                <i class="fas fa-music text-white text-xl"></i>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-bold text-gray-900 dark:text-white" id="stats-total-music">0</div>
                                <div class="text-sm text-gray-500 dark:text-gray-400">Pistes</div>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600 dark:text-gray-400">En cours:</span>
                                <span class="font-medium text-pink-600" id="stats-current-track">Aucune</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600 dark:text-gray-400">Durée totale:</span>
                                <span class="font-medium" id="stats-total-duration">0h 0m</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600 dark:text-gray-400">Module DJ:</span>
                                <span class="font-medium text-red-500" id="stats-dj-status">Hors ligne</span>
                            </div>
                        </div>
                    </div>

                    <!-- Stockage -->
                    <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-xl p-6 border border-gray-200 dark:border-gray-700 hover:shadow-lg transition-all duration-200">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-indigo-500 rounded-lg flex items-center justify-center">
                                <i class="fas fa-hdd text-white text-xl"></i>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-bold text-gray-900 dark:text-white" id="stats-storage-used">0</div>
                                <div class="text-sm text-gray-500 dark:text-gray-400">MB utilisés</div>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600 dark:text-gray-400">Images:</span>
                                <span class="font-medium" id="stats-storage-images">0 MB</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600 dark:text-gray-400">Vidéos:</span>
                                <span class="font-medium" id="stats-storage-videos">0 MB</span>
                            </div>
                            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 mt-3">
                                <div class="bg-gradient-to-r from-purple-500 to-indigo-500 h-2 rounded-full transition-all duration-500" 
                                    style="width: 0%" id="stats-storage-bar"></div>
                            </div>
                            <div class="text-xs text-gray-500 dark:text-gray-400 text-center">
                                <span id="stats-storage-percent">0%</span> de l'espace utilisé
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Graphiques -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <!-- Graphique d'utilisation -->
                    <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-xl p-6 border border-gray-200 dark:border-gray-700">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center space-x-2">
                            <i class="fas fa-chart-area text-primary-500"></i>
                            <span>Évolution des médias</span>
                        </h3>
                        <div class="h-64">
                            <canvas id="media-evolution-chart"></canvas>
                        </div>
                    </div>

                    <!-- Répartition par zones -->
                    <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-xl p-6 border border-gray-200 dark:border-gray-700">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center space-x-2">
                            <i class="fas fa-chart-pie text-secondary-500"></i>
                            <span>Répartition par zones</span>
                        </h3>
                        <div class="h-64">
                            <canvas id="zones-distribution-chart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Historique d'activité -->
                <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-xl p-6 border border-gray-200 dark:border-gray-700 mb-8">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center space-x-2">
                        <i class="fas fa-history text-amber-500"></i>
                        <span>Activités récentes</span>
                    </h3>
                    
                    <div class="space-y-3" id="activity-log">
                        <!-- Activités générées dynamiquement -->
                        <div class="flex items-center space-x-3 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                            <div class="w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center">
                                <i class="fas fa-upload text-blue-600 text-xs"></i>
                            </div>
                            <div class="flex-1">
                                <div class="text-sm font-medium text-gray-900 dark:text-white">Upload de 3 images dans Zone Centrale</div>
                                <div class="text-xs text-gray-500 dark:text-gray-400">Il y a 2 minutes</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Actions d'export -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button onclick="exportStats('csv')" class="flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-lg hover:shadow-lg transition-all duration-200 hover:-translate-y-0.5">
                        <i class="fas fa-file-csv"></i>
                        <span>Exporter CSV</span>
                    </button>
                    
                    <button onclick="exportStats('pdf')" class="flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-red-500 to-pink-500 text-white rounded-lg hover:shadow-lg transition-all duration-200 hover:-translate-y-0.5">
                        <i class="fas fa-file-pdf"></i>
                        <span>Rapport PDF</span>
                    </button>
                    
                    <button onclick="refreshStats()" class="flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-lg hover:shadow-lg transition-all duration-200 hover:-translate-y-0.5">
                        <i class="fas fa-sync-alt"></i>
                        <span>Actualiser</span>
                    </button>
                </div>
            </section>

        </main>

     </div>

     <!-- Modal: Configuration de la zone -->
      <div id="zone-config-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center opacity-0 invisible transition-all duration-300">
        <div class="bg-white dark:bg-gray-800 rounded-xl w-full max-w-4xl mx-4 max-h-[90vh] overflow-hidden shadow-2xl transform scale-95 transition-transform duration-300">
            
            <!-- Modal Header -->
            <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
                <h3 id="zone-modal-title" class="text-xl font-bold text-gray-900 dark:text-white">Configuration Zone</h3>
                <button onclick="closeModal('zone-config-modal')" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                    <i class="fas fa-times text-gray-500 dark:text-gray-400"></i>
                </button>
            </div>
            
            <!-- Modal Body -->
            <div class="p-6 overflow-y-auto max-h-[70vh]">
                <div class="space-y-6">
                    
                    <!-- Saction de telechargement -->
                    <div>
                        <h4 class="font-semibold text-lg mb-4 text-gray-900 dark:text-white flex items-center space-x-2">
                            <i class="fas fa-upload text-primary-500"></i>
                            <span>Ajouter du Contenu</span>
                        </h4>
                        
                        <!-- Onglets -->
                        <div class="flex space-x-1 mb-4 bg-gray-100 dark:bg-gray-700 rounded-lg p-1">
                            <button class="tab-btn flex-1 py-2 px-4 rounded-md font-medium transition-colors bg-white dark:bg-gray-600 text-primary-600 dark:text-primary-400" data-tab="file">Fichier Local</button>
                            <button class="tab-btn flex-1 py-2 px-4 rounded-md font-medium transition-colors text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white" data-tab="url">URL Distante</button>
                        </div>
                        
                        <!-- Onglet - Telechargement de fichier -->
                        <div class="tab-content" id="file-tab">
                            <div id="modal-dropzone" class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center hover:border-primary-400 hover:bg-primary-50/50 dark:hover:bg-primary-900/20 transition-all cursor-pointer">
                                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                                <p class="text-gray-600 dark:text-gray-400 font-medium">Glissez vos images/vidéos ici ou cliquez pour sélectionner</p>
                                <input type="file" id="modal-file-input" class="hidden" multiple accept="image/*,video/*">
                            </div>
                        </div>
                        
                        <!-- Onglet - Telechargement d'URL -->
                        <div class="tab-content hidden" id="url-tab">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">URL de l'image ou vidéo</label>
                                    <input type="url" id="url-input" placeholder="https://example.com/image.jpg" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Titre (optionnel)</label>
                                    <input type="text" id="url-title" placeholder="Titre de l'élément" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors">
                                </div>
                                <button type="button" onclick="addUrlContent()" class="flex items-center justify-center space-x-2 px-4 py-2 bg-gradient-to-r from-primary-500 to-secondary-500 text-white rounded-lg hover:shadow-lg transition-all duration-200 hover:-translate-y-0.5">
                                    <i class="fas fa-plus"></i>
                                    <span>Ajouter URL</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Liste de contenu -->
                    <div>
                        <h4 class="font-semibold text-lg mb-4 text-gray-900 dark:text-white flex items-center space-x-2">
                            <i class="fas fa-list text-primary-500"></i>
                            <span>Contenu Actuel</span>
                        </h4>
                        <div id="zone-content-list" class="space-y-2 max-h-60 overflow-y-auto">
                            <!-- Contenu dynamique -->
                            <p class="text-center text-gray-500 dark:text-gray-400 py-8">Aucun contenu dans cette zone</p>
                        </div>
                    </div>
                    
                    <!-- Paramètre de zone -->
                    <div>
                        <h4 class="font-semibold text-lg mb-4 text-gray-900 dark:text-white flex items-center space-x-2">
                            <i class="fas fa-cog text-primary-500"></i>
                            <span>Paramètres de la Zone</span>
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Titre de la zone</label>
                                <input type="text" id="zone-title" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Durée d'affichage (sec)</label>
                                <input type="number" id="zone-duration" min="1" max="30" value="5" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Zone active</label>
                                <select id="zone-enabled" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors">
                                    <option value="true">Activée</option>
                                    <option value="false">Désactivée</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Modal Footer -->
            <div class="flex items-center justify-end space-x-3 p-6 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-750">
                <button onclick="closeModal('zone-config-modal')" class="flex items-center space-x-2 px-4 py-2 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors">
                    <i class="fas fa-times"></i>
                    <span>Annuler</span>
                </button>
                <button onclick="saveZoneConfig()" class="flex items-center space-x-2 px-4 py-2 bg-gradient-to-r from-primary-500 to-secondary-500 text-white rounded-lg hover:shadow-lg transition-all duration-200 hover:-translate-y-0.5">
                    <i class="fas fa-save"></i>
                    <span>Sauvegarder</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Modal: aperçu -->
     <div id="preview-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center opacity-0 invisible transition-all duration-300">
        <div class="bg-white dark:bg-gray-800 rounded-xl w-[95%] h-[90%] overflow-hidden shadow-2xl transform scale-95 transition-transform duration-300">
            
            <!-- Modal Header -->
            <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-bold text-gray-900 dark:text-white">Aperçu Live - TEASER</h3>
                <button onclick="closeModal('preview-modal')" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                    <i class="fas fa-times text-gray-500 dark:text-gray-400"></i>
                </button>
            </div>
            
            <!-- Modal Body -->
            <div class="h-[calc(100%-4rem)]">
                <iframe id="preview-iframe" src="/" class="w-full h-full border-0"></iframe>
            </div>
        </div>
    </div>

    <!-- Conteneur de notification -->
     <div id="notification-container" class="fixed top-20 right-6 z-50 space-y-3 pointer-events-none">
        <!-- Les notifications seront ajoutées dynamiquement ici -->
     </div>

    
    <!-- JavaScript -->
     <script>
        // Configuration de l'Admin
        window.ADMIN_CONFIG = {
            api_base: window.location.origin,
            current_zone: null,
            unsaved_changes: false,
            theme: localStorage.getItem('admin-theme') || 'dark'
        };

        class TeaserAdmin {
            constructor() {
                this.config = window.ADMIN_CONFIG;
                this.zones = ['left1', 'left2', 'left3', 'center'];
                this.sidebarCollapsed = false;
                // this.currentZoneData = {};
                this.init();
            }

            init() {
                console.log('TEASER Admin initialsié');

                this.initTheme();
                this.initSidebar();
                // this.initUserMenu();
                this.initNavigation();
                this.initDragAndDrop();
                this.initTabs();
                this.initFormListeners();
                this.loadInitialData();

                setTimeout(() => this.initSystemCharts(), 1000);

                // Sauvegarde automatique des brouillons tous les 30s
                // setInterval(() => this.saveDraft(), 30000);

                // Maj de l'état du systeme tous les 10s
                // setInterval(() => this.updateSystemStats(), 10000);

                setInterval(() => {
                    this.updateDashboardStats();
                    this.loadAllMediaLists(); 
                },30000);

                // Masquer la superposition de chargement
                setTimeout(() => {
                    document.getElementById('loading-overlay').classList.add('opacity-0', 'invisible');
                }, 500);
            }


            // GESTION DE THEMES
            initTheme() {
                const html = document.documentElement;
                const themeToggle = document.getElementById('theme-toggle');
                const themeIcon = themeToggle.querySelector('i');

                // Appliquer le theme enregistré
                if (this.config.theme === 'light') {
                    html.classList.remove('dark');
                    themeIcon.className = 'fas fa-moon text-gray-600';
                } else {
                    html.classList.add('dark');
                    themeIcon.className = 'fas fa-sun text-gray-300';
                }

                themeToggle.addEventListener('click', () => {
                    if (html.classList.contains('dark')) {
                        html.classList.remove('dark');
                        this.config.theme = 'light';
                        themeIcon.className = 'fas fa-moon text-gray-600';
                    } else {
                        html.classList.add('dark');
                        this.config.theme = 'dark';
                        themeIcon.className = 'fas fa-sun text-grey-300';
                    }

                    localStorage.setItem('admin-theme', this.config.theme);
                    this.showNotification(`Thème ${this.config.theme === 'dark' ? 'sombre' : 'clair'} activé`, 'success');
                });
            }


            // GESTION DES SIDEBAR
            initSidebar() {
                const menuToggle = document.getElementById('menu-toggle');
                const sidebar = document.getElementById('admin-sidebar');
                const overlay = document.getElementById('sidebar-overlay');
                
                menuToggle.addEventListener('click', () => {
                    if (window.innerWidth < 1024) {
                        // Mobile: toggle sidebar
                        sidebar.classList.toggle('-translate-x-full');
                        overlay.classList.toggle('opacity-0');
                        overlay.classList.toggle('invisible');
                    } else {
                        // Desktop: collapse/expand
                        this.toggleSidebarCollapse();
                    }
                });
                
                overlay.addEventListener('click', () => {
                    sidebar.classList.add('-translate-x-full');
                    overlay.classList.add('opacity-0', 'invisible');
                });
                
                // Gérer le redimensionnement de la fenetre
                window.addEventListener('resize', () => {
                    if (window.innerWidth >= 1024) {
                        sidebar.classList.remove('-translate-x-full');
                        overlay.classList.add('opacity-0', 'invisible');
                    }
                });
            }

            toggleSidebarCollapse() {
                const sidebar = document.getElementById('admin-sidebar');
                const main = document.getElementById('admin-main');
                
                this.sidebarCollapsed = !this.sidebarCollapsed;
                
                if (this.sidebarCollapsed) {
                    sidebar.classList.add('sidebar-collapsed');
                    main.classList.remove('lg:ml-80');
                    main.classList.add('lg:ml-20');
                } else {
                    sidebar.classList.remove('sidebar-collapsed');
                    main.classList.remove('lg:ml-20');
                    main.classList.add('lg:ml-80');
                }
                
                localStorage.setItem('sidebar-collapsed', this.sidebarCollapsed);
            }


            // USER MENU
            // initUserMenu() {
            //     const toggle = document.getElementById('user-menu-toggle');
            //     const dropdown = document.getElementById('user-dropdown');
                
            //     toggle.addEventListener('click', (e) => {
            //         e.stopPropagation();
            //         dropdown.classList.toggle('opacity-0');
            //         dropdown.classList.toggle('invisible');
            //         dropdown.classList.toggle('scale-95');
            //     });
                
            //     document.addEventListener('click', () => {
            //         dropdown.classList.add('opacity-0', 'invisible', 'scale-95');
            //     });
            // }


            // NAVIGATION
            initNavigation() {
                const navItems = document.querySelectorAll('.nav-item');
                const sections = document.querySelectorAll('.admin-section');
                const breadcrumb = document.getElementById('current-section');
                
                navItems.forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        
                        const targetSection = item.dataset.section;
                        const sectionTitle = item.querySelector('div div').textContent;
                        
                        // UMettre à jour la navigation
                        navItems.forEach(nav => {
                            nav.classList.remove('text-primary-600', 'dark:text-primary-400');
                            nav.querySelector('div').classList.remove('bg-primary-100', 'dark:bg-primary-900/50');
                            nav.querySelector('div').classList.add('bg-gray-100', 'dark:bg-gray-800');
                            nav.querySelector('i').classList.remove('text-primary-600', 'dark:text-primary-400');
                            nav.querySelector('i').classList.add('text-gray-600', 'dark:text-gray-400');
                        });
                        
                        item.classList.add('text-primary-600', 'dark:text-primary-400');
                        item.querySelector('div').classList.add('bg-primary-100', 'dark:bg-primary-900/50');
                        item.querySelector('div').classList.remove('bg-gray-100', 'dark:bg-gray-800');
                        item.querySelector('i').classList.add('text-primary-600', 'dark:text-primary-400');
                        item.querySelector('i').classList.remove('text-gray-600', 'dark:text-gray-400');
                        
                        breadcrumb.textContent = sectionTitle;
                        
                        // Mettre à jour les sections
                        sections.forEach(section => section.classList.add('hidden'));
                        const targetSectionEl = document.getElementById(targetSection + '-section');
                        if (targetSectionEl) {
                            targetSectionEl.classList.remove('hidden');
                        }
                        
                        // Fermer Sidebar mobile
                        if (window.innerWidth < 1024) {
                            document.getElementById('admin-sidebar').classList.add('-translate-x-full');
                            document.getElementById('sidebar-overlay').classList.add('opacity-0', 'invisible');
                        }
                    });
                });
            }


            // DRAG & DROP
            initDragAndDrop() {
                this.zones.forEach(zone => {
                    const dropzone = document.getElementById(`dropzone-${zone}`);
                    const fileInput = dropzone?.querySelector('.file-input');
                    
                    if (dropzone && fileInput) {
                        this.setupDropzone(dropzone, fileInput, zone);
                    }
                });
                
                // Modal dropzone
                const modalDropzone = document.getElementById('modal-dropzone');
                const modalFileInput = document.getElementById('modal-file-input');
                if (modalDropzone && modalFileInput) {
                    this.setupDropzone(modalDropzone, modalFileInput, 'modal');
                }
            }

            setupDropzone(dropzone, fileInput, zone) {
                dropzone.addEventListener('click', () => fileInput.click());
                
                fileInput.addEventListener('change', (e) => {
                    this.handleFileSelect(e.target.files, zone);
                });
                
                ['dragover', 'dragenter'].forEach(eventName => {
                    dropzone.addEventListener(eventName, (e) => {
                        e.preventDefault();
                        dropzone.classList.add('border-primary-400', 'bg-primary-50/50', 'dark:bg-primary-900/20');
                    });
                });
                
                ['dragleave', 'drop'].forEach(eventName => {
                    dropzone.addEventListener(eventName, (e) => {
                        e.preventDefault();
                        dropzone.classList.remove('border-primary-400', 'bg-primary-50/50', 'dark:bg-primary-900/20');
                    });
                });
                
                dropzone.addEventListener('drop', (e) => {
                    this.handleFileSelect(e.dataTransfer.files, zone);
                });
            }

            async handleFileSelect(files, zone) {
                if (!files || files.length === 0) return;
                
                const validFiles = Array.from(files).filter(file => this.isValidMediaFile(file));
                
                if (validFiles.length === 0) {
                    this.showNotification('Aucun fichier valide sélectionné', 'warning');
                    return;
                }
                
                const formData = new FormData();
                validFiles.forEach(file => formData.append('files', file));
                
                // Gérer correctement les zones
                let targetZone = zone;
                if (zone === 'modal' && this.config.current_zone) {
                    targetZone = this.config.current_zone;
                }
                
                formData.append('zone', targetZone);
                
                try {
                    this.showNotification(`Upload de ${validFiles.length} fichier(s)...`, 'info');
                    
                    const response = await fetch('/api/admin/upload', {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        this.showNotification(`${result.uploaded_count} fichier(s) uploadé(s)`, 'success');
                        
                        // Actualiser immédiatement les listes de médias
                        await this.refreshAfterChange(targetZone);
                        
                        this.markUnsavedChanges();
                    } else {
                        throw new Error(result.message || 'Upload failed');
                    }
                    
                } catch (error) {
                    console.error('Upload error:', error);
                    this.showNotification('Erreur d\'upload: ' + error.message, 'error');
                }
            }

            async refreshAfterChange(specificZone = null) {
                try {
                    // Actualiser les listes de médias et mockup
                    await this.loadAllMediaLists(specificZone);
                    
                    // Actualiser les stats du dashboard (cartes du haut)
                    // await this.updateDashboardStats();
                     await new Promise(resolve => setTimeout(resolve, 200));
                    
                    // Si modal ouverte, actualiser le contenu
                    // if (this.config.current_zone) {
                    //     await this.loadZoneContent(this.config.current_zone);
                    // }
                    await this.updateDashboardStats();

                    // Si modal ouverte, actualiser le contenu
                    if (this.config.current_zone) {
                        await this.loadZoneContent(this.config.current_zone);
                    }
                    
                    // Si on est sur analytics, actualiser aussi
                    // const analyticsSection = document.getElementById('analytics-section');
                    // if (analyticsSection && !analyticsSection.classList.contains('hidden')) {
                    //     await loadDetailedStats();
                    // }
                    const analyticsSection = document.getElementById('analytics-section');
                    if (analyticsSection && !analyticsSection.classList.contains('hidden')) {
                        await loadDetailedStats();
                    }
                    
                    console.log('Interface actualisée après changement');
                    
                } catch (error) {
                    console.error('Erreur refresh after change:', error);
                }
            }

            isValidMediaFile(file) {
                const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp', 
                                   'video/mp4', 'video/webm', 'video/ogg'];
                const maxSize = 50 * 1024 * 1024; // 50MB
                
                if (!validTypes.includes(file.type)) {
                    this.showNotification(`Type de fichier non supporté: ${file.name}`, 'warning');
                    return false;
                }
                
                if (file.size > maxSize) {
                    this.showNotification(`Fichier trop volumineux: ${file.name}`, 'warning');
                    return false;
                }
                
                return true;
            }

            // CHARGEMENT DES DONNEES
            async loadInitialData() {
                try {
                    await this.loadAllMediaLists();
                    // await this.loadSystemStats();
                    await this.updateDashboardStats();

                    console.log('Données initiales chargées avec succès')
                } catch (error) {
                    console.error('Erreur de chargement de données:', error);
                    console.log('Chargement en mode dégradé')
                    this.showNotification('Erreur de chargement des données', 'error');
                }
            }

            // Mettre à jour les stats
            async updateDashboardStats() {
                try {
                    const response = await fetch('/api/admin/stats/dashboard');
                    if (response.ok) {
                        const data = await response.json();
                        if (data.success) {
                            // Synchroniser les cartes du haut et de la section analytics
                            this.animateNumber('total-media', data.stats.medias);
                            this.animateNumber('total-selfies', data.stats.selfies);
                            this.animateNumber('total-music', data.stats.pistes);
                            this.animateNumber('storage-used', data.stats.storage_mb);
                            // this.animateStatsUpdate(data.stats);

                            // Synchroniser aussi les stats analytics si la section est visible
                            const analyticsSection = document.getElementById('analytics-section');
                            if (analyticsSection && !analyticsSection.classList.contains('hidden')) {
                                this.animateNumber('stats-total-media', data.stats.medias);
                                this.animateNumber('stats-total-selfies', data.stats.selfies);
                                this.animateNumber('stats-total-music', data.stats.pistes);
                                this.animateNumber('stats-storage-used', data.stats.storage_mb);
                            }
                        }
                    }
                } catch (error) {
                    console.error('Erreur stats dashboard:', error);
                }
            }

            async updateTopCards() {
                try {
                    const response = await fetch('/api/admin/stats/dashboard');
                    if (response.ok) {
                        const data = await response.json();
                        if (data.success) {
                            this.animateNumber('total-media', data.stats.medias);
                            this.animateNumber('total-selfies', data.stats.selfies);
                            this.animateNumber('total-music', data.stats.pistes);
                            this.animateNumber('storage-used', data.stats.storage_mb);
                        }
                    }
                } catch (error) {
                    console.error('Erreur mise à jour cartes:', error);
                }
            }

            // méthode pour animer la mise à jour des cartes
            animateStatsUpdate(stats) {
                // Mettre à jour les cartes avec animation
                this.animateNumber('total-media', stats.medias);
                this.animateNumber('total-selfies', stats.selfies);
                this.animateNumber('total-music', stats.pistes);
                this.animateNumber('storage-used', stats.storage_mb);

                // Mettre à jour les cartes de la section analytics
                this.animateNumber('stats-total-media', stats.medias);
                this.animateNumber('stats-total-selfies', stats.selfies);
                this.animateNumber('stats-total-music', stats.pistes);
                this.animateNumber('stats-storage-used', stats.storage_mb);
                
                console.log('Stats mises à jour:', stats);
            }

            async loadAllMediaLists(specificZone = null) {
                // Simulation du chargement des listes média
                console.log('Chargement de toute la liste des médias ...');
                const zones = specificZone ? [specificZone] : ['left1', 'left2', 'left3', 'center'];
                for (const zone of zones) {
                    try {
                        const response = await fetch(`/api/admin/media/${zone}`);
                        if (response.ok) {
                            const data = await response.json();
                            console.log(`Zone ${zone}:`, data.content?.length || 0, 'fichiers');
                            this.updateZoneCount(zone, data.content?.length || 0);

                            // Mettre à jour l'apercu du mockup
                            this.updateMockupZonePreview(zone, data.content || [])
                        }
                    } catch (error) {
                        console.log(`Pas de médias pour ${zone}`)
                    }
                }
            }

            // méthode pour mettre à jour l'apercu du Mockup
            updateMockupZonePreview(zone, mediaFiles) {
                const countElement = document.getElementById(`${zone}-count`);
                const iconElement = document.getElementById(`${zone}-icon`);

                if (countElement) {
                    const count = mediaFiles.length;
                    countElement.textContent = `${count} élément${count !== 1 ? 's' : ''}`;
                }

                if (iconElement) {
                    if (mediaFiles.length > 0) {
                        iconElement.className = 'fas fa-images text-2xl mb-2 opacity-70';
                    } else {
                        iconElement.className = 'fas fa-plus text-2xl mb-2 opacity-70';
                    }
                }
            }

            // méthode pour mettre à jour le compteur de zone
            updateZoneCount(zone, count) {
                const countElement = document.getElementById(`${zone}-count`);
                if (countElement) {
                    countElement.textContent = `${count} élément${count !== 1 ? 's' : ''}`;
                }
            }

            // méthode pour charger le contenu d'une zone pour la modale
            async loadZoneContent(zone) {
                try {
                    const response = await fetch(`/api/admin/media/${zone}`);
                    if (response.ok) {
                        const data = await response.json();
                        this.updateZoneContentList(data.content || []);
                    }
                } catch (error) {
                    console.error(`Erreur de chargement zone ${zone}:`, error);
                }
            }

            // méthode pour mettre à jour la liste de contenu dans la modale
            updateZoneContentList(mediaFiles) {
                const contentList = document.getElementById('zone-content-list');
                if (!contentList) return;

                if (mediaFiles.length === 0) {
                    contentList.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400 py-8">Aucun contenu dans cette zone</p>';
                    return;
                }

                contentList.innerHTML = mediaFiles.map(media => `
                    <div class="flex items-center space-x-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <div class="w-12 h-12 bg-gray-200 dark:bg-gray-600 rounded-lg overflow-hidden flex-shrink-0">
                            ${media.type === 'image' 
                                ? `<img src="${media.src}" alt="${media.filename}" class="w-full h-full object-cover">`
                                : media.type === 'video'
                                ? `<div class="w-full h-full flex items-center justify-center"><i class="fas fa-video text-gray-400"></i></div>`
                                : `<div class="w-full h-full flex items-center justify-center"><i class="fas fa-link text-blue-400"></i></div>`
                            }
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="text-sm font-medium text-gray-900 dark:text-white truncate">${media.filename}</div>
                            <div class="text-xs text-gray-500 dark:text-gray-400">
                                ${media.type === 'url' ? `URL: ${media.url}` : media.type}
                            </div>
                        </div>
                        <button onclick="deleteMediaItem('${encodeURIComponent(media.filename)}')" class="p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors">
                            <i class="fas fa-trash text-sm"></i>
                        </button>
                    </div>
                `).join('');
            }


            // NOTIFICATIONS
            showNotification(message, type = 'info', duration = 3000) {
                const container = document.getElementById('notification-container');
                const notification = document.createElement('div');
                
                const icons = {
                    success: 'fas fa-check-circle text-green-500',
                    error: 'fas fa-exclamation-circle text-red-500',
                    warning: 'fas fa-exclamation-triangle text-yellow-500',
                    info: 'fas fa-info-circle text-blue-500'
                };
                
                const colors = {
                    success: 'border-green-200 bg-green-50 dark:border-green-800 dark:bg-green-900/20',
                    error: 'border-red-200 bg-red-50 dark:border-red-800 dark:bg-red-900/20',
                    warning: 'border-yellow-200 bg-yellow-50 dark:border-yellow-800 dark:bg-yellow-900/20',
                    info: 'border-blue-200 bg-blue-50 dark:border-blue-800 dark:bg-blue-900/20'
                };
                
                notification.className = `pointer-events-auto flex items-center space-x-3 p-4 rounded-lg border ${colors[type]} transform translate-x-full transition-transform duration-300 shadow-lg`;
                notification.innerHTML = `
                    <div class="flex-shrink-0">
                        <i class="${icons[type]} text-lg"></i>
                    </div>
                    <div class="flex-1">
                        <p class="text-sm font-medium text-gray-900 dark:text-white">${message}</p>
                    </div>
                    <button class="flex-shrink-0 p-1 rounded hover:bg-black/10 dark:hover:bg-white/10 transition-colors">
                        <i class="fas fa-times text-gray-400 text-sm"></i>
                    </button>
                `;
                
                // Bouton de fermeture
                notification.querySelector('button').addEventListener('click', () => {
                    this.removeNotification(notification);
                });
                
                container.appendChild(notification);
                
                // Animation
                setTimeout(() => {
                    notification.classList.remove('translate-x-full');
                }, 100);
                
                // Suppression automatique
                setTimeout(() => {
                    this.removeNotification(notification);
                }, duration);
                
                this.stackNotifications();
            }

            removeNotification(notification) {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                    this.stackNotifications();
                }, 300);
            }

            markUnsavedChanges() {
                this.config.unsaved_changes = true;
                const saveBtn = document.getElementById('save-btn');
                const indicator = document.getElementById('save-indicator');
                
                if (saveBtn && indicator) {
                    indicator.classList.remove('opacity-0', 'scale-0');
                    indicator.classList.add('opacity-100', 'scale-100');
                }
            }

            markChangesSaved() {
                this.config.unsaved_changes = false;
                const indicator = document.getElementById('save-indicator');
                
                if (indicator) {
                    indicator.classList.add('opacity-0', 'scale-0');
                    indicator.classList.remove('opacity-100', 'scale-100');
                }
            }

            stackNotifications() {
                const notifications = document.querySelectorAll('#notification-container > div:not(.translate-x-full)');
                notifications.forEach((notification, index) => {
                    notification.style.transform = `translateY(${index * 80}px)`;
                });
            }


            // ONGLETS
            initTabs() {
                const tabButtons = document.querySelectorAll('.tab-btn');
                
                tabButtons.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const targetTab = btn.dataset.tab;
                        
                        // Bouton de mise à jour
                        tabButtons.forEach(b => {
                            b.classList.remove('bg-white', 'dark:bg-gray-600', 'text-primary-600', 'dark:text-primary-400');
                            b.classList.add('text-gray-600', 'dark:text-gray-300');
                        });
                        btn.classList.add('bg-white', 'dark:bg-gray-600', 'text-primary-600', 'dark:text-primary-400');
                        btn.classList.remove('text-gray-600', 'dark:text-gray-300');
                        
                        // Mettre à jour le contenu
                        document.querySelectorAll('.tab-content').forEach(content => {
                            content.classList.add('hidden');
                        });
                        document.getElementById(targetTab + '-tab').classList.remove('hidden');
                    });
                });
            }


            // AUDITEURS FORM
            initFormListeners() {
                document.addEventListener('change', (e) => {
                    if (e.target.matches('input, select, textarea')) {
                        this.markUnsavedChanges();
                        
                        // Affichage de la valeur de la plage mise à jour
                        if (e.target.type === 'range') {
                            const value = Math.round(e.target.value * 100);
                            const valueDisplay = document.getElementById('volume-value');
                            if (valueDisplay) {
                                valueDisplay.textContent = value + '%';
                            }
                        }
                    }
                });
            }


            // ETAT DU SYSTEME
            async updateSystemStats() {
                await this.updateDashboardStats();
            }

            animateNumber(elementId, targetValue) {
                const element = document.getElementById(elementId);
                if (!element) return;
                
                const currentValue = parseInt(element.textContent) || 0;
                // Si les valeurs sont identiques, pas d'animation
                if (currentValue === targetValue) {
                    return;
                }
                
                // Arrêter toute animation en cours sur cet élément
                if (element._animationInterval) {
                    clearInterval(element._animationInterval);
                }
                const increment = (targetValue - currentValue) / 20;
                let current = currentValue;
                
                const animation = setInterval(() => {
                    current += increment;
                    
                    if ((increment > 0 && current >= targetValue) || 
                        (increment < 0 && current <= targetValue)) {
                        current = targetValue;
                        clearInterval(animation);
                    }
                    
                    element.textContent = Math.floor(current);
                }, 50);
            }

            // async loadCurrentConfig() {
            //     // Implementiation sumulée
            //     console.log('Loading configuration...');
            // }

            // Nouvelle méthode pour mettre à jour l'apercu du Mockup
            updateMockupZonePreview(zone, mediaFiles) {
                const countElement = document.getElementById(`${zone}-count`);
                const iconElement = document.getElementById(`${zone}-icon`);

                if (countElement) {
                    const count = mediaFiles.length;
                    countElement.textContent = `${count} élément${count !== 1 ? 's' : ''}`;
                }

                if (iconElement) {
                    if (mediaFiles.length > 0) {
                        iconElement.className = 'fas fa-images text-2xl mb-2 opacity-70';
                    } else {
                        iconElement.className = 'fas fa-plus text-2xl mb-2 opacity-70';
                    }
                }
            }

            async loadMediaLists() {
                // Implementiation sumulée
                // console.log('Loading media lists...');
                console.log(`Loading media list for zone: ${zone}`);
                try {
                    const response = await fetch(`/api/admin/media/${zone}`);
                    if (response.ok) {
                        const data = await response.json();
                        console.log(`Zone ${zone} loaded:`, data);
                        // Mettre à jour l'interface si nécessaire
                        this.updateZonePreview(zone, data.content || []);
                    }
                } catch (error) {
                    console.log(`No media found for zone ${zone}`);
                }
            }

            updateZonePreview(zone, mediaFiles) {
                // Mettre à jour l'aperçu de la zone dans le mockup
                const countElement = document.getElementById(`${zone}-count`);
                const iconElement = document.getElementById(`${zone}-icon`);
                
                if (countElement) {
                    const count = mediaFiles.length;
                    countElement.textContent = `${count} élément${count !== 1 ? 's' : ''}`;
                }
                
                if (iconElement && mediaFiles.length > 0) {
                    iconElement.className = 'fas fa-images text-2xl mb-2 opacity-70';
                }
            }

            async updateMockupPreview() {
                // Implementiation sumulée - MAJ les zones apercues
                this.zones.forEach(zone => {
                    const count = Math.floor(Math.random() * 10);
                    const countElement = document.getElementById(`${zone}-count`);
                    const iconElement = document.getElementById(`${zone}-icon`);
                    
                    if (countElement) {
                        countElement.textContent = `${count} élément${count !== 1 ? 's' : ''}`;
                    }
                    
                    if (iconElement && count > 0) {
                        iconElement.className = 'fas fa-images text-2xl mb-2 opacity-70';
                    }
                });
            }

            async checkSystemStatus() {
                // Implementation simulée
                console.log('Checking system status...');
            }


            // AIDES A L'UI
            showUploadProgress(show) {
                // Implementation for upload progress
                if (show) {
                    console.log('Showing upload progress...');
                } else {
                    console.log('Hiding upload progress...');
                }
            }

            async saveDraft() {
                if (!this.config.unsaved_changes) return;
                console.log('Saving draft...');
            }

            gatherAllConfig() {
                return {
                    timestamp: Date.now(),
                    zones: this.zones,
                    config: this.config
                };
            }
        }

        
        // FONCTIONS GLOBALES
        let adminInstance;

        // Initialisé quand DOM est chargé
        document.addEventListener('DOMContentLoaded', function() {
            adminInstance = new TeaserAdmin();
        });

        // Fonctions modales
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('opacity-0', 'invisible');
            modal.querySelector('.transform').classList.remove('scale-95');
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.add('opacity-0', 'invisible');
            modal.querySelector('.transform').classList.add('scale-95');
        }

        // Fonction d'action globale
        function openPreview() {
            openModal('preview-modal');
            document.getElementById('preview-iframe').src = '/?_t=' + Date.now();
        }

        function openDJ() {
            window.open('/admin/lecteur', '_blank');
        }

        function saveAllConfig() {
            if (!adminInstance) return;
            
            adminInstance.showNotification('Sauvegarde en cours...', 'info');
            
            const config = adminInstance.gatherAllConfig();
            
            // Sauvegarde simulé
            setTimeout(() => {
                adminInstance.showNotification('Configuration sauvegardée avec succès', 'success');
                adminInstance.markChangesSaved();
            }, 1500);
        }

        function openZoneConfig(zone) {
            if (!adminInstance) return;
            
            adminInstance.config.current_zone = zone;
            document.getElementById('zone-modal-title').textContent = `Configuration ${zone.toUpperCase()}`;
            // Charger le contenu actuel de la zone
            adminInstance.loadZoneContent(zone);
            openModal('zone-config-modal');
        }

        function saveZoneConfig() {
            if (!adminInstance) return;
            
            adminInstance.showNotification('Configuration de zone sauvegardée', 'success');
            closeModal('zone-config-modal');
            adminInstance.markChangesSaved();
        }

        async function refreshAllData() {
            if (!adminInstance) return;
            
            adminInstance.showNotification('Actualisation en cours...', 'info');
            
            try {
                // 1. Actualiser les stats du dashboard (cartes du haut)
                await adminInstance.updateDashboardStats();
                
                // 2. Actualiser les listes de médias et mockup
                await adminInstance.loadAllMediaLists();
                
                // 3. Si on est sur la section analytics, actualiser aussi
                const analyticsSection = document.getElementById('analytics-section');
                if (analyticsSection && !analyticsSection.classList.contains('hidden')) {
                    await loadDetailedStats();
                    initAnalyticsCharts();
                }
                
                adminInstance.showNotification('Données actualisées avec succès', 'success');
                
            } catch (error) {
                console.error('Erreur actualisation:', error);
                adminInstance.showNotification('Erreur lors de l\'actualisation', 'error');
            }
        }

        async function runCleanup() {
            if (!confirm('Êtes-vous sûr de vouloir nettoyer les fichiers anciens ?')) return;
            
            adminInstance.showNotification('Nettoyage en cours...', 'info');
            
            try {
                const response = await fetch('/api/admin/cleanup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    adminInstance.showNotification(
                        `Nettoyage terminé: ${result.deleted_files} fichiers supprimés`, 
                        'success'
                    );
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                adminInstance.showNotification(`Erreur nettoyage: ${error.message}`, 'error');
            }
        }

        async function testAllConnections() {
            if (!adminInstance) return;
            
            adminInstance.showNotification('Test des connexions...', 'info');
            
            let successCount = 0;
            let totalTests = 0;
            
            // Test météo
            try {
                totalTests++;
                const weatherResponse = await fetch('/api/admin/test-weather', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ location: 'Paris,FR' })
                });
                
                if (weatherResponse.ok) {
                    const weatherResult = await weatherResponse.json();
                    if (weatherResult.success) successCount++;
                }
            } catch (e) {
                console.error('Test météo échoué:', e);
            }
            
            // Test marées
            try {
                totalTests++;
                const tideResponse = await fetch('/api/admin/test-tide', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ lat: 43.4832, lon: -1.5586 })
                });
                
                if (tideResponse.ok) {
                    const tideResult = await tideResponse.json();
                    if (tideResult.success) successCount++;
                }
            } catch (e) {
                console.error('Test marées échoué:', e);
            }
            
            // Test selfie
            try {
                totalTests++;
                const selfieResponse = await fetch('/api/admin/test-selfie', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                
                if (selfieResponse.ok) {
                    const selfieResult = await selfieResponse.json();
                    if (selfieResult.success) successCount++;
                }
            } catch (e) {
                console.error('Test selfie échoué:', e);
            }
            
            // Résultat final
            if (successCount === totalTests) {
                adminInstance.showNotification('Toutes les connexions sont opérationnelles', 'success');
            } else {
                adminInstance.showNotification(
                    `${successCount}/${totalTests} connexions opérationnelles`, 
                    'warning'
                );
            }
        }

        function viewLogs() {
            window.open('/api/admin/logs', '_blank');
        }

        function downloadBackup() {
            adminInstance.showNotification('Génération du backup...', 'info');
            setTimeout(() => {
                window.location.href = '/api/admin/backup';
            }, 1000);
        }

        // Fonction pour supprimer un média
        async function deleteMediaItem(filename) {
            if (!adminInstance) return;
            
            // Confirmation avant suppression
            if (!confirm('Êtes-vous sûr de vouloir supprimer ce fichier ?')) {
                return;
            }
            
            try {
                // Récupérer la zone courante depuis la configuration
                const currentZone = adminInstance.config.current_zone;
                
                if (!currentZone) {
                    adminInstance.showNotification('Erreur: zone non définie', 'error');
                    return;
                }
                
                adminInstance.showNotification('Suppression en cours...', 'info');
                
                // Appeler l'API de suppression
                const response = await fetch(`/api/admin/media/${currentZone}/${filename}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    adminInstance.showNotification('Fichier supprimé avec succès', 'success');

                    // Actualisation immédiatement toute l'interface
                    await adminInstance.refreshAfterChange(currentZone)
                    
                    // Recharger le contenu de la zone pour mettre à jour l'affichage
                    // await adminInstance.loadZoneContent(currentZone);
                    
                    // Mettre à jour le mockup
                    // await adminInstance.loadAllMediaLists(currentZone);
                    
                    // Marquer les changements comme non sauvegardés
                    // adminInstance.markUnsavedChanges();
                } else {
                    throw new Error(result.message || 'Erreur de suppression');
                }
                
            } catch (error) {
                console.error('Erreur suppression:', error);
                adminInstance.showNotification(`Erreur lors de la suppression: ${error.message}`, 'error');
            }
        }

        // Fonction de test API
        // function testWeatherAPI() {
        //     adminInstance.showNotification('Test de l\'API météo...', 'info');
        //     setTimeout(() => {
        //         adminInstance.showNotification('API Météo connectée avec succès', 'success');
        //     }, 2000);
        // }
        async function testWeatherAPI() {
            if (!adminInstance) return;
            
            adminInstance.showNotification('Test de l\'API météo...', 'info');
            
            try {
                // Récupérer la localisation du formulaire
                const form = document.getElementById('weather-config-form');
                const location = form.querySelector('input[name="weather_location"]').value || 'Paris,FR';
                
                // Appeler l'API de test
                const response = await fetch('/api/admin/test-weather', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        location: location
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Afficher les résultats dans l'interface
                    displayWeatherResults(result.data);
                    adminInstance.showNotification(
                        `Météo récupérée pour ${result.data.location}`, 
                        'success'
                    );
                } else {
                    adminInstance.showNotification(`${result.message}`, 'error');
                }
                
            } catch (error) {
                console.error('Erreur test météo:', error);
                adminInstance.showNotification('Erreur de connexion à l\'API météo', 'error');
            }
        }
 
        async function testTideAPI() {
            if (!adminInstance) return;
            
            adminInstance.showNotification('Test de l\'API marées...', 'info');
            
            try {
                // Récupérer lat/lon du formulaire
                const form = document.getElementById('tide-config-form');
                const lat = form.querySelector('input[name="tide_lat"]').value || 43.4832;
                const lon = form.querySelector('input[name="tide_lon"]').value || -1.5586;
                
                // Appeler l'API de test
                const response = await fetch('/api/admin/test-tide', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        lat: parseFloat(lat),
                        lon: parseFloat(lon)
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Afficher les résultats dans l'interface
                    displayTideResults(result.data);
                    adminInstance.showNotification(
                        `Marées récupérées pour ${result.data.lat.toFixed(4)}, ${result.data.lon.toFixed(4)}`, 
                        'success'
                    );
                } else {
                    adminInstance.showNotification(`${result.message}`, 'error');
                }
                
            } catch (error) {
                console.error('Erreur test marées:', error);
                adminInstance.showNotification('Erreur de connexion à l\'API marées', 'error');
            }
        }

        function testSelfieModule() {
            adminInstance.showNotification('Test du module selfie...', 'info');
            setTimeout(() => {
                adminInstance.showNotification('Module Selfie OK (12 photos trouvées)', 'success');
            }, 1500);
        }

        function testDJModule() {
            adminInstance.showNotification('Test du module DJ...', 'info');
            setTimeout(() => {
                adminInstance.showNotification('Module DJ/Jukebox connecté avec succès', 'success');
            }, 1500);
        }

        async function addUrlContent() {
            const url = document.getElementById('url-input').value;
            const title = document.getElementById('url-title').value;
            
            if (!url) {
                adminInstance.showNotification('Veuillez remplir l\'URL', 'warning');
                return;
            }

            // validation de l'url
            try {
                new URL(url);
            } catch {
                adminInstance.showNotification('URL invalide', 'warning');
                return;
            }
            
            if (!adminInstance.config.current_zone) {
                adminInstance.showNotification('Erreur: zone non définie', 'error');
                return;
            }
            
            try {
                adminInstance.showNotification('Ajout de l\'URL en cours...', 'info');
                
                const response = await fetch('/api/admin/add-url-content', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        zone: adminInstance.config.current_zone,
                        url: url,
                        title: title
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Vider les champs
                    document.getElementById('url-input').value = '';
                    document.getElementById('url-title').value = '';
                    
                    // Recharger le contenu de la zone
                    // await adminInstance.loadZoneContent(adminInstance.config.current_zone);
                    // await adminInstance.loadAllMediaLists(adminInstance.config.current_zone);
                    
                    adminInstance.showNotification('URL ajoutée avec succès', 'success');
                    await adminInstance.refreshAfterChange(adminInstance.config.current_zone);
                    adminInstance.markUnsavedChanges();
                } else {
                    throw new Error(result.message);
                }
                
            } catch (error) {
                console.error('Erreur ajout URL:', error);
                adminInstance.showNotification('Erreur lors de l\'ajout: ' + error.message, 'error');
            }
        }

        // Nouvelles fonctions pour afficher les résultats
        function displayWeatherResults(data) {
            // Créer ou mettre à jour la zone d'affichage météo
            let resultsDiv = document.getElementById('weather-results');
            if (!resultsDiv) {
                resultsDiv = document.createElement('div');
                resultsDiv.id = 'weather-results';
                resultsDiv.className = 'mt-4 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg';
                
                // Insérer après le bouton de test
                const weatherForm = document.getElementById('weather-config-form');
                weatherForm.appendChild(resultsDiv);
            }
            
            resultsDiv.innerHTML = `
                <h4 class="font-semibold text-blue-700 dark:text-blue-300 mb-2">
                    <i class="fas fa-cloud-sun mr-2"></i>Résultat du test météo
                </h4>
                <div class="space-y-2 text-sm">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-map-marker-alt text-red-500"></i>
                        <span><strong>Ville:</strong> ${data.location}</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-thermometer-half text-orange-500"></i>
                        <span><strong>Température:</strong> ${data.temperature}</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <i class="fas ${data.full_data.icone} text-blue-500"></i>
                        <span><strong>Conditions:</strong> ${data.description}</span>
                    </div>
                </div>
            `;
        }

        function displayTideResults(data) {
            // Créer ou mettre à jour la zone d'affichage marées
            let resultsDiv = document.getElementById('tide-results');
            if (!resultsDiv) {
                resultsDiv = document.createElement('div');
                resultsDiv.id = 'tide-results';
                resultsDiv.className = 'mt-4 p-4 bg-cyan-50 dark:bg-cyan-900/20 border border-cyan-200 dark:border-cyan-800 rounded-lg';
                
                // Insérer après le bouton de test
                const tideForm = document.getElementById('tide-config-form');
                tideForm.appendChild(resultsDiv);
            }
            
            resultsDiv.innerHTML = `
                <h4 class="font-semibold text-cyan-700 dark:text-cyan-300 mb-2">
                    <i class="fas fa-water mr-2"></i>Résultat du test marées
                </h4>
                <div class="space-y-2 text-sm">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-map-marker-alt text-red-500"></i>
                        <span><strong>Position:</strong> ${data.lat.toFixed(4)}, ${data.lon.toFixed(4)}</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-water text-cyan-500"></i>
                        <span><strong>Prochaine marée:</strong> ${data.tide_text}</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-clock text-gray-500"></i>
                        <span><strong>Heure:</strong> ${data.tide_time}</span>
                    </div>
                </div>
            `;
        }

        // Gérer les racourcis clavier
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                saveAllConfig();
            }
            
            if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
                e.preventDefault();
                refreshAllData();
            }
            
            if (e.key === 'Escape') {
                const modals = document.querySelectorAll('[id$="-modal"]:not(.opacity-0)');
                modals.forEach(modal => {
                    modal.classList.add('opacity-0', 'invisible');
                    modal.querySelector('.transform').classList.add('scale-95');
                });
            }
        });

        // Prévenir la perte de données
        window.addEventListener('beforeunload', (e) => {
            if (adminInstance && adminInstance.config.unsaved_changes) {
                e.preventDefault();
                e.returnValue = 'Des modifications non sauvegardées seront perdues.';
                return e.returnValue;
            }
        });

    </script>
     
    
    <!-- Script pour les stats -->
    <script>
    // Variables pour les graphiques
    let mediaEvolutionChart = null;
    let zonesDistributionChart = null;

    // Fonction pour initialiser les graphiques avec vraies données
    async function initAnalyticsCharts() {
        try {
            // 1. Graphique d'évolution des médias (7 derniers jours)

            const periodFilter = document.getElementById('period-filter');
            const selectedPeriod = periodFilter ? periodFilter.value : '7_days';

            const mediaEvolutionData = await fetch(`/api/admin/stats/media-evolution?period=${selectedPeriod}`);
            const mediaEvolutionJson = await mediaEvolutionData.json();
            
            const mediaCtx = document.getElementById('media-evolution-chart');
            if (mediaCtx && typeof Chart !== 'undefined') {
                if (mediaEvolutionChart) {
                    mediaEvolutionChart.destroy();
                }
                
                const evolutionData = mediaEvolutionJson.success ? mediaEvolutionJson.data : {
                    labels: ["1", "2", "3", "4", "5", "6", "7"],
                    counts: [0, 0, 0, 0, 0, 0, 0]
                };

                // adapter le titre en fonction de la période
                let xAxisTitle = "Jours du mois";
                let tooltipFormat = (context) => {
                    const count = context.parsed.y;
                    return count + 'média' + (count > 1 ? 's' : '') + ' uploadé' + (count > 1 ? 's' : '');
                };

                if (selectedPeriod === '30_days') {
                    xAxisTitle = "Périodes de 5 jours";
                        tooltipFormat = (context) => {
                        const count = context.parsed.y;
                        return count + ' média' + (count > 1 ? 's' : '') + ' sur 5 jours';
                    };
                } else if (selectedPeriod === 'current_month') {
                    xAxisTitle = "Semaines du mois";
                    tooltipFormat = (context) => {
                        const count = context.parsed.y;
                        return count + ' média' + (count > 1 ? 's' : '') + ' cette semaine';
                    };
                }
                
                mediaEvolutionChart = new Chart(mediaCtx, {
                    type: 'line',
                    data: {
                        labels: evolutionData.labels,
                        datasets: [{
                            label: 'Médias uploadés',
                            data: evolutionData.counts,
                            borderColor: '#6366f1',
                            backgroundColor: 'rgba(99, 102, 241, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#6366f1',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            pointHoverRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            // tooltip: {
                            //     callbacks: {
                            //         // title: function(context) {
                            //         //     const index = context[0].dataIndex;
                            //         //     if (evolutionData.full_dates && evolutionData.full_dates[index]) {
                            //         //         const date = new Date(evolutionData.full_dates[index]);
                            //         //         return date.toLocaleDateString('fr-FR', { 
                            //         //             weekday: 'long', 
                            //         //             day: 'numeric', 
                            //         //             month: 'long' 
                            //         //         });
                            //         //     }
                            //         //     return 'Jour ' + evolutionData.labels[index];
                            //         // },
                            //         title: function(context) {
                            //             const index = context[0].dataIndex;
                            //             const label = evolutionData.labels[index];
                                        
                            //             if (selectedPeriod === '30_days') {
                            //                 return `Jours ${label} du mois`;
                            //             } else if (selectedPeriod === 'current_month') {
                            //                 return `Semaine ${label.replace('S', '')}`;
                            //             } else if (evolutionData.full_dates && evolutionData.full_dates[index]) {
                            //                 const date = new Date(evolutionData.full_dates[index]);
                            //                 return date.toLocaleDateString('fr-FR', { 
                            //                     weekday: 'long', 
                            //                     day: 'numeric', 
                            //                     month: 'long' 
                            //                 });
                            //             }
                            //             return 'Jour ' + label;
                            //         },
                            //         // label: function(context) {
                            //         //     const count = context.parsed.y;
                            //         //     return count + ' média' + (count > 1 ? 's' : '') + ' uploadé' + (count > 1 ? 's' : '');
                            //         // }
                            //         label: tooltipFormat
                            //     }
                            // }
                            tooltip: {
                                callbacks: {
                                    title: function(context) {
                                        const index = context[0].dataIndex;
                                        const label = evolutionData.labels[index];
                                        
                                        if (selectedPeriod === '30_days') {
                                            return `Jours ${label} du mois`;
                                        } else if (selectedPeriod === 'current_month') {
                                            return `Semaine ${label.replace('S', '')}`;
                                        } else if (evolutionData.full_dates && evolutionData.full_dates[index]) {
                                            const date = new Date(evolutionData.full_dates[index]);
                                            return date.toLocaleDateString('fr-FR', { 
                                                weekday: 'long', 
                                                day: 'numeric', 
                                                month: 'long' 
                                            });
                                        }
                                        return 'Jour ' + label;
                                    },
                                    label: function(context) {
                                        const count = context.parsed.y;
                                        if (selectedPeriod === '30_days') {
                                            return count + ' média' + (count > 1 ? 's' : '') + ' sur 5 jours';
                                        } else if (selectedPeriod === 'current_month') {
                                            return count + ' média' + (count > 1 ? 's' : '') + ' cette semaine';
                                        } else {
                                            return count + ' média' + (count > 1 ? 's' : '') + ' uploadé' + (count > 1 ? 's' : '');
                                        }
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    display: false
                                },
                                ticks: {
                                    color: document.documentElement.classList.contains('dark') ? '#9CA3AF' : '#6B7280'
                                },
                                title: {
                                    display: true,
                                    text: selectedPeriod === '30_days' ? 'Périodes de 5 jours' : 
                                            selectedPeriod === 'current_month' ? 'Semaines du mois' : 
                                            'Jours du mois',
                                    color: document.documentElement.classList.contains('dark') ? '#9CA3AF' : '#6B7280'
                                }
                            },
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: document.documentElement.classList.contains('dark') ? '#374151' : '#E5E7EB'
                                },
                                ticks: {
                                    color: document.documentElement.classList.contains('dark') ? '#9CA3AF' : '#6B7280',
                                    stepSize: 1,
                                    callback: function(value) {
                                        return Number.isInteger(value) ? value : '';
                                    }
                                },
                                title: {
                                    display: true,
                                    text: 'Nombre de fichiers',
                                    color: document.documentElement.classList.contains('dark') ? '#9CA3AF' : '#6B7280'
                                }
                            }
                        }
                    }
                });
            }

            // 2. Graphique de répartition par zones
            const zonesDistributionData = await fetch('/api/admin/stats/zones-distribution');
            const zonesDistributionJson = await zonesDistributionData.json();
            
            const zonesCtx = document.getElementById('zones-distribution-chart');
            if (zonesCtx && typeof Chart !== 'undefined') {
                if (zonesDistributionChart) {
                    zonesDistributionChart.destroy();
                }
                
                const distributionData = zonesDistributionJson.success ? zonesDistributionJson.data : {
                    labels: ['Zone 1', 'Zone 2', 'Zone 3', 'Centre'],
                    counts: [0, 0, 0, 0]
                };
                
                zonesDistributionChart = new Chart(zonesCtx, {
                    type: 'doughnut',
                    data: {
                        labels: distributionData.labels,
                        datasets: [{
                            data: distributionData.counts,
                            backgroundColor: [
                                '#3B82F6',
                                '#10B981', 
                                '#F59E0B',
                                '#EF4444'
                            ],
                            borderWidth: 0,
                            hoverOffset: 10
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true,
                                    color: document.documentElement.classList.contains('dark') ? '#F3F4F6' : '#1F2937'
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const count = context.parsed;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = total > 0 ? Math.round((count / total) * 100) : 0;
                                        return context.label + ': ' + count + ' fichier' + (count > 1 ? 's' : '') + ' (' + percentage + '%)';
                                    }
                                }
                            }
                        },
                        cutout: '60%'
                    }
                });
            }
            
        } catch (error) {
            console.error('Erreur initialisation graphiques:', error);
            // Fallback avec données par défaut si l'API échoue
            initFallbackCharts();
        }
    }

    // Graphiques de fallback en cas d'erreur API
    function initFallbackCharts() {
        const mediaCtx = document.getElementById('media-evolution-chart');
        if (mediaCtx && typeof Chart !== 'undefined') {
            mediaEvolutionChart = new Chart(mediaCtx, {
                type: 'line',
                data: {
                    labels: ['29', '30', '31', '1', '2', '3', '4'],
                    datasets: [{
                        label: 'Médias uploadés',
                        data: [0, 0, 0, 0, 0, 0, 0],
                        borderColor: '#6366f1',
                        backgroundColor: 'rgba(99, 102, 241, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        const zonesCtx = document.getElementById('zones-distribution-chart');
        if (zonesCtx && typeof Chart !== 'undefined') {
            zonesDistributionChart = new Chart(zonesCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Zone 1', 'Zone 2', 'Zone 3', 'Centre'],
                    datasets: [{
                        data: [0, 0, 0, 0],
                        backgroundColor: ['#3B82F6', '#10B981', '#F59E0B', '#EF4444'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%'
                }
            });
        }
    }

    // Fonction pour charger les statistiques détaillées
    async function loadDetailedStats() {
        try {
            console.log('Chargement des statistiques détaillées...');
            
            // Charger les stats détaillées depuis l'API
            const response = await fetch('/api/admin/stats/detailed');
            if (response.ok) {
                const data = await response.json();
                if (data.success) {
                    console.log('Stats détaillées reçues:', data.stats);
                    updateDetailedStatsUI(data.stats);
                    
                    // Mettre à jour l'historique d'activité avec les vraies données
                    if (data.stats.activity) {
                        updateActivityLog(data.stats.activity);
                    }
                    
                    return;
                }
            }
            
            // Fallback vers l'ancienne API si la nouvelle n'est pas disponible
            console.log('Fallback vers stats dashboard...');
            const fallbackResponse = await fetch('/api/admin/stats/dashboard');
            if (fallbackResponse.ok) {
                const fallbackData = await fallbackResponse.json();
                if (fallbackData.success) {
                    updateBasicStatsUI(fallbackData.stats);
                }
            }
            
        } catch (error) {
            console.error('Erreur chargement stats détaillées:', error);
            // Générer un historique par défaut en cas d'erreur
            updateActivityLog([]);
        }
    }

    // Fonction pour mettre à jour le log d'activité avec scroll
    function updateActivityLog(activities) {
        console.log('Mise à jour activités:', activities);
        
        const activityContainer = document.getElementById('activity-log');
        if (!activityContainer) return;
        
        if (!activities || activities.length === 0) {
            activityContainer.innerHTML = `
                <div class="flex items-center space-x-3 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                    <div class="w-8 h-8 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center">
                        <i class="fas fa-info-circle text-gray-400 text-xs"></i>
                    </div>
                    <div class="flex-1">
                        <div class="text-sm font-medium text-gray-900 dark:text-white">Aucune activité récente</div>
                        <div class="text-xs text-gray-500 dark:text-gray-400">Uploadez des médias pour voir l'activité</div>
                    </div>
                </div>
            `;
            return;
        }
        
        // Afficher les 5 premières activités directement
        const firstFive = activities.slice(0, 5);
        const remaining = activities.slice(5);
        
        let html = firstFive.map(activity => `
            <div class="flex items-center space-x-3 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                <div class="w-8 h-8 ${activity.bg} rounded-full flex items-center justify-center">
                    <i class="${activity.icon} text-xs"></i>
                </div>
                <div class="flex-1">
                    <div class="text-sm font-medium text-gray-900 dark:text-white">${activity.description}</div>
                    <div class="text-xs text-gray-500 dark:text-gray-400">${activity.time_ago}${activity.size_mb ? ` • ${activity.size_mb} MB` : ''}</div>
                </div>
            </div>
        `).join('');
        
        // Ajouter un bouton "Voir plus" et le contenu caché si il y a plus de 5 activités
        if (remaining.length > 0) {
            html += `
                <div class="text-center py-2">
                    <button id="show-more-activities" class="text-sm text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 font-medium">
                        Voir plus d'activités (${remaining.length})
                    </button>
                </div>
                <div id="more-activities" class="hidden space-y-3">
                    ${remaining.map(activity => `
                        <div class="flex items-center space-x-3 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                            <div class="w-8 h-8 ${activity.bg} rounded-full flex items-center justify-center">
                                <i class="${activity.icon} text-xs"></i>
                            </div>
                            <div class="flex-1">
                                <div class="text-sm font-medium text-gray-900 dark:text-white">${activity.description}</div>
                                <div class="text-xs text-gray-500 dark:text-gray-400">${activity.time_ago}${activity.size_mb ? ` • ${activity.size_mb} MB` : ''}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        activityContainer.innerHTML = html;
        
        // Ajouter l'événement pour "Voir plus"
        const showMoreBtn = document.getElementById('show-more-activities');
        if (showMoreBtn) {
            showMoreBtn.addEventListener('click', function() {
                const moreActivities = document.getElementById('more-activities');
                const isHidden = moreActivities.classList.contains('hidden');
                
                if (isHidden) {
                    moreActivities.classList.remove('hidden');
                    showMoreBtn.textContent = 'Voir moins';
                } else {
                    moreActivities.classList.add('hidden');
                    showMoreBtn.textContent = `Voir plus d'activités (${remaining.length})`;
                }
            });
        }
    }

    // Fonction pour mettre à jour l'UI des stats détaillées 
    function updateDetailedStatsUI(stats) {
        if (!stats) {
            // Données par défaut en cas d'erreur
            stats = {
                media_total: 0,
                zones: {
                    left1: { count: 0, size_mb: 0 },
                    left2: { count: 0, size_mb: 0 },
                    left3: { count: 0, size_mb: 0 },
                    center: { count: 0, size_mb: 0 }
                },
                selfies: {
                    total: 0,
                    today: 0,
                    week: 0,
                    total_size_mb: 0,
                    storage_mb: 0
                },
                storage: {
                    total_mb: 0,
                    images_mb: 0,
                    videos_mb: 0,
                    selfies_mb: 0
                },
                music: {
                    total_tracks: 0,
                    current_track: "Aucune",
                    total_duration: "0h 0m",
                    dj_status: "offline"
                }
            };
        }

        function customRoundDisplay(value) {
            const decimalPart = value - Math.floor(value);
            return decimalPart >= 0.55 ? Math.ceil(value) : Math.floor(value);
        }

        // Mise à jour des cartes principales
        const totalStorageMB = customRoundDisplay(stats.storage.total_mb);
        document.getElementById('stats-total-media').textContent = stats.media_total;
        document.getElementById('stats-total-selfies').textContent = stats.selfies.total;
        document.getElementById('stats-total-music').textContent = stats.music.total_tracks;
        document.getElementById('stats-storage-used').textContent = totalStorageMB;

        // Synchroniser avec l'affichage du haut (cartes en haut de page)
        const topStorageElement = document.getElementById('storage-used');
        if (topStorageElement) {
            topStorageElement.textContent = totalStorageMB;
        }
        
        // Détails par zones
        document.getElementById('stats-left1').textContent = stats.zones.left1.count;
        document.getElementById('stats-left2').textContent = stats.zones.left2.count;
        document.getElementById('stats-left3').textContent = stats.zones.left3.count;
        document.getElementById('stats-center').textContent = stats.zones.center.count;
        
        // Détails selfies
        document.getElementById('stats-selfies-today').textContent = stats.selfies.today;
        document.getElementById('stats-selfies-week').textContent = stats.selfies.week;
        document.getElementById('stats-selfies-avg').textContent = stats.selfies.total_size_mb.toFixed(2) + ' MB';
        
        // Détails musique
        document.getElementById('stats-current-track').textContent = stats.music.current_track;
        document.getElementById('stats-total-duration').textContent = stats.music.total_duration;
        document.getElementById('stats-dj-status').textContent = stats.music.dj_status === 'online' ? 'En ligne' : 'Hors ligne';
        document.getElementById('stats-dj-status').className = stats.music.dj_status === 'online' 
            ? 'font-medium text-green-500' 
            : 'font-medium text-red-500';
        
        // Détails stockage avec séparation images/vidéos/selfies
        document.getElementById('stats-storage-images').textContent = stats.storage.images_mb.toFixed(2) + ' MB';
        document.getElementById('stats-storage-videos').textContent = stats.storage.videos_mb.toFixed(2) + ' MB';
        
        // Barre de progression (supposons 1GB = 1000MB de limite)
        const maxStorage = 1000;
        const percent = Math.min((stats.storage.total_mb / maxStorage) * 100, 100);
        document.getElementById('stats-storage-bar').style.width = percent + '%';
        document.getElementById('stats-storage-percent').textContent = percent.toFixed(2) + '%';
        
        // Couleur de la barre selon l'utilisation
        const bar = document.getElementById('stats-storage-bar');
        if (percent > 80) {
            bar.className = 'bg-gradient-to-r from-red-500 to-pink-500 h-2 rounded-full transition-all duration-500';
        } else if (percent > 60) {
            bar.className = 'bg-gradient-to-r from-yellow-500 to-orange-500 h-2 rounded-full transition-all duration-500';
        } else {
            bar.className = 'bg-gradient-to-r from-purple-500 to-indigo-500 h-2 rounded-full transition-all duration-500';
        }
    }

    // Fonction pour générer l'historique d'activité
    function generateActivityLog() {
        const activities = [
            {
                icon: 'fas fa-upload text-blue-600',
                bg: 'bg-blue-100 dark:bg-blue-900/30',
                text: 'Upload de médias dans Zone Centrale',
                time: 'Il y a 2 minutes'
            },
            {
                icon: 'fas fa-chart-line text-green-600',
                bg: 'bg-green-100 dark:bg-green-900/30',
                text: 'Statistiques mises à jour',
                time: 'Il y a 5 minutes'
            },
            {
                icon: 'fas fa-cog text-gray-600',
                bg: 'bg-gray-100 dark:bg-gray-700',
                text: 'Configuration système sauvegardée',
                time: 'Il y a 15 minutes'
            },
            {
                icon: 'fas fa-camera text-purple-600',
                bg: 'bg-purple-100 dark:bg-purple-900/30',
                text: 'Nouveaux selfies détectés',
                time: 'Il y a 1 heure'
            },
            {
                icon: 'fas fa-broom text-orange-600',
                bg: 'bg-orange-100 dark:bg-orange-900/30',
                text: 'Nettoyage automatique effectué',
                time: 'Il y a 6 heures'
            }
        ];
        
        const activityContainer = document.getElementById('activity-log');
        if (activityContainer) {
            activityContainer.innerHTML = activities.map(activity => `
                <div class="flex items-center space-x-3 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                    <div class="w-8 h-8 ${activity.bg} rounded-full flex items-center justify-center">
                        <i class="${activity.icon} text-xs"></i>
                    </div>
                    <div class="flex-1">
                        <div class="text-sm font-medium text-gray-900 dark:text-white">${activity.text}</div>
                        <div class="text-xs text-gray-500 dark:text-gray-400">${activity.time}</div>
                    </div>
                </div>
            `).join('');
        }
    }

    // Fonctions d'export
    function exportStats(format) {
        if (!adminInstance) return;
        
        adminInstance.showNotification(`Export ${format.toUpperCase()} en cours...`, 'info');
        
        setTimeout(() => {
            const data = {
                medias: document.getElementById('stats-total-media').textContent,
                selfies: document.getElementById('stats-total-selfies').textContent,
                pistes: document.getElementById('stats-total-music').textContent,
                storage: document.getElementById('stats-storage-used').textContent,
                date: new Date().toLocaleDateString('fr-FR'),
                time: new Date().toLocaleTimeString('fr-FR'),
                // Données détaillées pour PDF
                left1: document.getElementById('stats-left1')?.textContent || '0',
                left2: document.getElementById('stats-left2')?.textContent || '0',
                left3: document.getElementById('stats-left3')?.textContent || '0',
                center: document.getElementById('stats-center')?.textContent || '0',
                selfiesToday: document.getElementById('stats-selfies-today')?.textContent || '0',
                selfiesWeek: document.getElementById('stats-selfies-week')?.textContent || '0',
                storageImages: document.getElementById('stats-storage-images')?.textContent || '0 MB',
                storageVideos: document.getElementById('stats-storage-videos')?.textContent || '0 MB'
            };
            
            if (format === 'csv') {
                const csv = `Type,Valeur,Date\nMédias,${data.medias},${data.date}\nSelfies,${data.selfies},${data.date}\nPistes,${data.pistes},${data.date}\nStockage MB,${data.storage},${data.date}`;
                downloadFile(csv, 'teaser-stats.csv', 'text/csv');
            } else if (format === 'pdf') {
                generatePDFReport(data);
            }
            
            adminInstance.showNotification(`Fichier ${format.toUpperCase()} téléchargé`, 'success');
        }, 1500);
    }

    function downloadFile(content, filename, contentType) {
        const blob = new Blob([content], { type: contentType });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
    }

    // Fonction pour générer le rapport PDF
    function generatePDFReport(data) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        // Configuration des couleurs et polices
        const primaryColor = [99, 102, 241]; // #6366f1
        const textColor = [51, 51, 51]; // #333
        const lightGray = [100, 116, 139]; // #64748b
        
        let yPosition = 20;
        
        // En-tête du rapport
        doc.setFontSize(24);
        doc.setTextColor(...primaryColor);
        doc.text('Rapport TEASER', 105, yPosition, { align: 'center' });
        
        yPosition += 10;
        doc.setFontSize(12);
        doc.setTextColor(...lightGray);
        doc.text('Module Événementiel - Interface d\'Administration', 105, yPosition, { align: 'center' });
        
        yPosition += 6;
        doc.text(`Généré le ${data.date} à ${data.time}`, 105, yPosition, { align: 'center' });
        
        // Ligne de séparation
        yPosition += 10;
        doc.setDrawColor(...primaryColor);
        doc.setLineWidth(1);
        doc.line(20, yPosition, 190, yPosition);
        
        yPosition += 15;
        
        // Section Statistiques Générales
        doc.setFontSize(16);
        doc.setTextColor(...primaryColor);
        doc.text('Statistiques Générales', 20, yPosition);
        
        yPosition += 10;
        doc.setFontSize(10);
        doc.setTextColor(...textColor);
        
        // Grille des statistiques (2x2)
        const statBoxWidth = 85;
        const statBoxHeight = 25;
        
        // Média Totaux
        doc.rect(20, yPosition, statBoxWidth, statBoxHeight);
        doc.setFontSize(8);
        doc.text('Médias Totaux', 25, yPosition + 6);
        doc.setFontSize(16);
        doc.setTextColor(...primaryColor);
        doc.text(data.medias, 25, yPosition + 15);
        doc.setFontSize(8);
        doc.setTextColor(...textColor);
        doc.text('Fichiers images et vidéos', 25, yPosition + 20);
        
        // Selfies
        doc.rect(110, yPosition, statBoxWidth, statBoxHeight);
        doc.text('Selfies', 115, yPosition + 6);
        doc.setFontSize(16);
        doc.setTextColor(...primaryColor);
        doc.text(data.selfies, 115, yPosition + 15);
        doc.setFontSize(8);
        doc.setTextColor(...textColor);
        doc.text('Photos capturées', 115, yPosition + 20);
        
        yPosition += 30;
        
        // Pistes Musicales
        doc.rect(20, yPosition, statBoxWidth, statBoxHeight);
        doc.text('Pistes Musicales', 25, yPosition + 6);
        doc.setFontSize(16);
        doc.setTextColor(...primaryColor);
        doc.text(data.pistes, 25, yPosition + 15);
        doc.setFontSize(8);
        doc.setTextColor(...textColor);
        doc.text('Fichiers audio disponibles', 25, yPosition + 20);
        
        // Stockage Utilisé
        doc.rect(110, yPosition, statBoxWidth, statBoxHeight);
        doc.text('Stockage Utilisé', 115, yPosition + 6);
        doc.setFontSize(16);
        doc.setTextColor(...primaryColor);
        doc.text(data.storage + ' MB', 115, yPosition + 15);
        doc.setFontSize(8);
        doc.setTextColor(...textColor);
        doc.text('Mégaoctets', 115, yPosition + 20);
        
        yPosition += 40;
        
        // Section Répartition par Zones
        doc.setFontSize(16);
        doc.setTextColor(...primaryColor);
        doc.text('Répartition par Zones', 20, yPosition);
        
        yPosition += 10;
        
        // Tableau des zones
        doc.setFontSize(10);
        doc.setTextColor(...textColor);
        
        // En-têtes du tableau
        doc.setFillColor(241, 245, 249); // #f1f5f9
        doc.rect(20, yPosition, 170, 8, 'F');
        doc.setFontSize(9);
        doc.setTextColor(55, 65, 81); // #374151
        doc.text('Zone', 25, yPosition + 5);
        doc.text('Fichiers', 80, yPosition + 5);
        doc.text('Description', 120, yPosition + 5);
        
        yPosition += 8;
        
        // Données du tableau
        const zones = [
            ['Zone Gauche 1', data.left1, 'Colonne gauche première zone'],
            ['Zone Gauche 2', data.left2, 'Colonne gauche deuxième zone'],
            ['Zone Gauche 3', data.left3, 'Colonne gauche troisième zone'],
            ['Zone Centrale', data.center, 'Carrousel principal']
        ];
        
        doc.setFontSize(9);
        doc.setTextColor(...textColor);
        
        zones.forEach((zone, index) => {
            if (index % 2 === 0) {
                doc.setFillColor(248, 250, 252); // #f8fafc
                doc.rect(20, yPosition, 170, 8, 'F');
            }
            doc.text(zone[0], 25, yPosition + 5);
            doc.text(zone[1].toString(), 80, yPosition + 5);
            doc.text(zone[2], 120, yPosition + 5);
            yPosition += 8;
        });
        
        yPosition += 10;
        
        // Section Détails Complémentaires
        doc.setFontSize(16);
        doc.setTextColor(...primaryColor);
        doc.text('Détails Complémentaires', 20, yPosition);
        
        yPosition += 10;
        
        // Tableau des détails
        doc.setFillColor(241, 245, 249);
        doc.rect(20, yPosition, 170, 8, 'F');
        doc.setFontSize(9);
        doc.setTextColor(55, 65, 81);
        doc.text('Métrique', 25, yPosition + 5);
        doc.text('Valeur', 80, yPosition + 5);
        doc.text('Période', 120, yPosition + 5);
        
        yPosition += 8;
        
        const details = [
            ['Selfies aujourd\'hui', data.selfiesToday, '24 dernières heures'],
            ['Selfies cette semaine', data.selfiesWeek, '7 derniers jours'],
            ['Stockage Images', data.storageImages, 'Total'],
            ['Stockage Vidéos', data.storageVideos, 'Total']
        ];
        
        doc.setFontSize(9);
        doc.setTextColor(...textColor);
        
        details.forEach((detail, index) => {
            if (index % 2 === 0) {
                doc.setFillColor(248, 250, 252);
                doc.rect(20, yPosition, 170, 8, 'F');
            }
            doc.text(detail[0], 25, yPosition + 5);
            doc.text(detail[1].toString(), 80, yPosition + 5);
            doc.text(detail[2], 120, yPosition + 5);
            yPosition += 8;
        });
        
        // Pied de page
        yPosition = 280;
        doc.setFontSize(8);
        doc.setTextColor(...lightGray);
        doc.text('Module TEASER - Système de Gestion Événementielle', 105, yPosition, { align: 'center' });
        doc.text('Interface d\'administration --- Rapport généré automatiquement', 105, yPosition + 5, { align: 'center' });
        
        // Télécharger le PDF
        const filename = `teaser-rapport-${data.date.replace(/\//g, '-')}-${data.time.replace(/:/g, 'h')}.pdf`;
        doc.save(filename);
    }

    function refreshStats() {
        if (!adminInstance) return;
        
        adminInstance.showNotification('Actualisation des statistiques...', 'info');
        
        // Recharger les graphiques
        initAnalyticsCharts();
        
        // Recharger les stats détaillées
        loadDetailedStats();
        
        setTimeout(() => {
            adminInstance.showNotification('Statistiques actualisées', 'success');
        }, 1000);
    }

    // Initialiser les stats quand on navigue vers la section
    document.addEventListener('DOMContentLoaded', function() {
        // Observer les changements de section
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                    const analyticsSection = document.getElementById('analytics-section');
                    if (analyticsSection && !analyticsSection.classList.contains('hidden')) {
                        // Section analytics visible, initialiser les graphiques
                        setTimeout(() => {
                            initAnalyticsCharts();
                            loadDetailedStats();
                        }, 100);
                    }
                }
            });
        });
        
        const analyticsSection = document.getElementById('analytics-section');
        if (analyticsSection) {
            observer.observe(analyticsSection, { attributes: true });
        }
    });

    // Mettre à jour les graphiques lors du changement de thème
    document.addEventListener('click', function(e) {
        if (e.target.id === 'theme-toggle' || e.target.closest('#theme-toggle')) {
            setTimeout(() => {
                if (mediaEvolutionChart) {
                    mediaEvolutionChart.destroy();
                }
                if (zonesDistributionChart) {
                    zonesDistributionChart.destroy();
                }
                setTimeout(initAnalyticsCharts, 200);
            }, 100);
        }
    });

    // Ajouter un filtre de période pour l'évolution
    function addPeriodFilter() {
        const analyticsSection = document.getElementById('analytics-section');
        if (analyticsSection) {
            const evolutionChart = analyticsSection.querySelector('h3:has(+ div canvas#media-evolution-chart)');
            if (evolutionChart) {
                // Ajouter un sélecteur de période
                const filterHtml = `
                    <div class="flex items-center space-x-2 ml-auto">
                        <label class="text-sm text-gray-600 dark:text-gray-400">Période:</label>
                        <select id="period-filter" class="text-sm border border-gray-300 dark:border-gray-600 rounded px-2 py-1 bg-white dark:bg-gray-700">
                            <option value="7_days">7 derniers jours</option>
                            <option value="30_days">30 derniers jours</option>
                            <option value="current_month">Mois actuel</option>
                        </select>
                    </div>
                `;
                
                evolutionChart.classList.add('flex', 'items-center');
                evolutionChart.insertAdjacentHTML('beforeend', filterHtml);
                
                // Gérer le changement de filtre
                // document.getElementById('period-filter').addEventListener('change', function() {
                //     adminInstance.showNotification('Mise à jour du graphique...', 'info');
                //     setTimeout(() => {
                //         initAnalyticsCharts(); // Recharger avec nouvelle période
                //         adminInstance.showNotification('Graphique mis à jour', 'success');
                //     }, 500);
                // });
                document.getElementById('period-filter').addEventListener('change', function() {
                    adminInstance.showNotification('Mise à jour du graphique...', 'info');
                    setTimeout(() => {
                        initAnalyticsCharts(); // Recharger avec nouvelle période
                        adminInstance.showNotification('Graphique mis à jour', 'success');
                    }, 500);
                });
                // document.getElementById('period-filter').addEventListener('change', function() {
                //     if (adminInstance) {
                //         adminInstance.showNotification('Mise à jour du graphique...', 'info');
                //     }
                    
                //     setTimeout(() => {
                //         initAnalyticsCharts(); // Recharger avec nouvelle période
                //         if (adminInstance) {
                //             adminInstance.showNotification('Graphique mis à jour', 'success');
                //         }
                //     }, 500);
                // });
            }
        }
    }

    // Ajouter le filtre après initialisation
    setTimeout(addPeriodFilter, 2000);
</script>

</body>

</html>